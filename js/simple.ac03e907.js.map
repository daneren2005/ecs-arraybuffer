{"version":3,"file":"js/simple.ac03e907.js","mappings":"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","sources":["webpack://ecs-arraybuffer/./src/simple/entities/entity.ts","webpack://ecs-arraybuffer/./src/simple/entities/ship.ts","webpack://ecs-arraybuffer/./src/simple/entities/station.ts","webpack://ecs-arraybuffer/./src/simple/entities/world.ts","webpack://ecs-arraybuffer/./node_modules/vue-loader/dist/index.js","webpack://ecs-arraybuffer/./src/simple/SimpleGame.vue?eefb","webpack://ecs-arraybuffer/./src/simple/SimpleGame.vue?f2aa","webpack://ecs-arraybuffer/./src/simple/SimpleGame.vue?efa1","webpack://ecs-arraybuffer/./src/simple/SimpleGame.vue"],"sourcesContent":["import { EventEmitter } from 'eventemitter3';\nimport World from './world';\n\nexport default class Entity extends EventEmitter {\n\tworld: World;\n\n\tid: number;\n\tx = 0;\n\ty = 0;\n\twidth = 0;\n\theight = 0;\n\tangle = 0;\n\tvelocityX = 0;\n\tvelocityY = 0;\n\ttype = 'entity';\n\tkey = 'boid';\n\tshields = 1;\n\tmaxShields = 1;\n\ttimeToRegenerateShields = 1;\n\ttimeSinceShieldRegeneration = 0;\n\ttimeSinceTakenDamage = 0;\n\tdead = false;\n\n\tconstructor(world: World) {\n\t\tsuper();\n\n\t\tthis.world = world;\n\t\tthis.id = world.getId();\n\t}\n\n\tload(config: any) {\n\t\tObject.keys(config).forEach((key: string) => {\n\t\t\t// @ts-expect-error\n\t\t\tthis[key] = config[key];\n\t\t});\n\t}\n\n\tupdate(delta: number) {\n\t\tthis.set('x', this.x + this.velocityX * delta);\n\t\tthis.set('y', this.y + this.velocityY * delta);\n\t\tthis.set('timeSinceTakenDamage', this.timeSinceTakenDamage + delta);\n\n\t\tif(this.shields < this.maxShields) {\n\t\t\tthis.set('timeSinceShieldRegeneration', this.timeSinceShieldRegeneration + delta);\n\t\t\tif(this.timeSinceShieldRegeneration > this.timeToRegenerateShields) {\n\t\t\t\tthis.set('shields', this.shields + 1);\n\t\t\t\tthis.set('timeSinceShieldRegeneration', 0);\n\t\t\t}\n\t\t}\n\t}\n\n\tset(prop: string, value: any) {\n\t\t// @ts-expect-error\n\t\tthis[prop] = value;\n\t\tthis.emit(`${prop}-updated`, value);\n\t}\n\n\tdie() {\n\t\t// Only emit dead once\n\t\tif(this.dead) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.dead = true;\n\t\tthis.emit('dead');\n\t}\n\tcanTakeDamage() {\n\t\treturn this.timeSinceTakenDamage >= 0.2;\n\t}\n\ttakeDamage(damage: number) {\n\t\tif(!this.canTakeDamage()) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.set('shields', this.shields - damage);\n\t\tthis.set('timeSinceTakenDamage', 0);\n\t\tif(this.shields < 0) {\n\t\t\tthis.die();\n\t\t}\n\t}\n}","import computeAngle from '@/math/compute-angle';\nimport distance from '@/math/distance';\nimport euclideanDistance from '@/math/euclidean-distance';\nimport Entity from './entity';\nimport Station from './station';\nconst PhaserMath = require('phaser/src/math');\n\nexport default class Ship extends Entity {\n\tstation: Station;\n\tspeed = 100;\n\n\tconstructor(station: Station) {\n\t\tsuper(station.world);\n\t\tthis.station = station;\n\t\tthis.width = 10;\n\t\tthis.height = 5;\n\t}\n\n\tget color(): number {\n\t\treturn this.station.color;\n\t}\n\n\tupdate(delta: number) {\n\t\tthis.keepInBounds();\n\n\t\tlet nearesetEnemy = this.getNearestEnemy();\n\t\tif(nearesetEnemy) {\n\t\t\t// Bounce off enemy doing damage\n\t\t\tif(distance(nearesetEnemy.x, nearesetEnemy.y, this.x, this.y) < Math.max(this.width, nearesetEnemy.width)) {\n\t\t\t\tthis.collide(nearesetEnemy);\n\t\t\t\tthis.set('velocityX', -this.velocityX);\n\t\t\t\tthis.set('velocityY', -this.velocityY);\n\t\t\t}\n\t\t\t// Move towards enemy\n\t\t\telse {\n\t\t\t\tlet force = this.getMoveTowardsForce(nearesetEnemy);\n\t\t\t\tlet newVelocity = new PhaserMath.Vector2(this.velocityX + force.x * 4, this.velocityY + force.y * 4);\n\t\t\t\tnewVelocity.normalize();\n\n\t\t\t\tthis.set('velocityX', newVelocity.x * this.speed);\n\t\t\t\tthis.set('velocityY', newVelocity.y * this.speed);\n\n\t\t\t\tthis.set('angle', computeAngle(this.velocityX, this.velocityY));\n\t\t\t}\n\t\t}\n\n\t\t// TODO: This should not be needed, but somehow ships are staying alive even after station is destroyed\n\t\tif(this.station.dead) {\n\t\t\tthis.die();\n\t\t}\n\n\t\tsuper.update(delta);\n\t}\n\t\n\tkeepInBounds() {\n\t\tif(this.x < 0) {\n\t\t\tthis.set('velocityX', Math.abs(this.velocityX));\n\t\t} else if(this.x > this.world.bounds.width) {\n\t\t\tthis.set('velocityX', -Math.abs(this.velocityX));\n\t\t}\n\n\t\tif(this.y < 0) {\n\t\t\tthis.set('velocityY', Math.abs(this.velocityY));\n\t\t} else if(this.y > this.world.bounds.height) {\n\t\t\tthis.set('velocityY', -Math.abs(this.velocityY));\n\t\t}\n\t}\n\n\tgetNearestEnemy(): Entity | null {\n\t\tlet nearesetEnemy = this.world.getNearestEntity(this, entity => {\n\t\t\tif(entity instanceof Station) {\n\t\t\t\treturn entity !== this.station;\n\t\t\t} else if(entity instanceof Ship) {\n\t\t\t\treturn entity.station !== this.station;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\tif(nearesetEnemy) {\n\t\t\treturn nearesetEnemy;\n\t\t} else {\n\t\t\tlet stations = this.world.entities.filter(entity => entity instanceof Station && entity !== this.station);\n\t\t\tstations.sort((a, b) => {\n\t\t\t\treturn euclideanDistance(a.x, a.y, this.x, this.y) - euclideanDistance(b.x, b.y, this.x, this.y);\n\t\t\t});\n\n\t\t\treturn stations[0];\n\t\t}\n\t}\n\tgetMoveTowardsForce(entity: Entity) {\n\t\tlet force = new PhaserMath.Vector2(entity.x - this.x, entity.y - this.y);\n\t\tforce.normalize();\n\t\treturn force;\n\t}\n\n\tcollide(target: Entity) {\n\t\tif(!this.canTakeDamage() || !target.canTakeDamage()) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet enemyWorth = 1;\n\t\tif(target instanceof Station) {\n\t\t\tenemyWorth = target.ships.length;\n\t\t}\n\n\t\tthis.takeDamage(1);\n\t\ttarget.takeDamage(1);\n\n\t\tif(target.dead) {\n\t\t\tthis.station.set('money', this.station.money + enemyWorth);\n\t\t}\n\t\tif(this.dead) {\n\t\t\tif(target instanceof Station) {\n\t\t\t\ttarget.set('money', target.money + 1);\n\t\t\t} else if(target instanceof Ship) {\n\t\t\t\ttarget.station.set('money', target.station.money + 1);\n\t\t\t}\n\t\t}\n\t}\n}","import Entity from './entity';\nimport Ship from './ship';\nimport World from './world';\n\nexport default class Station extends Entity {\n\tcolor = 0xff0000;\n\tships: Array<Entity> = [];\n\tmoney = 0;\n\n\tconstructor(world: World) {\n\t\tsuper(world);\n\t\tthis.key = 'station';\n\t\tthis.width = 20;\n\t\tthis.height = 20;\n\t\tthis.shields = 2;\n\t\tthis.maxShields = 2;\n\t\tthis.timeToRegenerateShields = 5;\n\t}\n\n\tupdate(delta: number) {\n\t\tsuper.update(delta);\n\n\t\tif(this.money > 0) {\n\t\t\tlet ship = new Ship(this);\n\t\t\tship.x = this.x;\n\t\t\tship.y = this.y;\n\t\t\tship.velocityX = (Math.random() > 0.5 ? -1 : 1) * Math.random() * ship.speed;\n\t\t\tship.velocityY = (Math.random() > 0.5 ? -1 : 1) * Math.random() * ship.speed;\n\n\t\t\tthis.ships.push(ship);\n\t\t\tship.on('dead', () => {\n\t\t\t\tlet index = this.ships.indexOf(ship);\n\t\t\t\tif(index >= 0) {\n\t\t\t\t\tthis.ships.splice(index, 1);\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.world.addEntity(ship);\n\t\t\tthis.set('money', this.money - 1);\n\t\t}\n\t}\n\n\tdie() {\n\t\tsuper.die();\n\n\t\tthis.ships.forEach(ship => {\n\t\t\tship.die();\n\t\t});\n\t}\n}","import { EventEmitter } from 'eventemitter3';\nimport Entity from './entity';\nimport Station from './station';\nimport { Quadtree, Rectangle } from '@timohausmann/quadtree-ts/src/index.esm';\nimport euclideanDistance from '@/math/euclidean-distance';\n\nexport default class World extends EventEmitter {\n\tentities: Array<Entity> = [];\n\tbounds: {\n\t\twidth: number,\n\t\theight: number\n\t} = { width: 0, height: 0 };\n\tidCounter = 0;\n\t// @ts-expect-error\n\tquadtree: Quadtree;\n\n\tload(config: any) {\n\t\tconfig.entities.forEach((entityConfig: any) => {\n\t\t\tlet entity;\n\t\t\tswitch(entityConfig.type) {\n\t\t\t\tcase 'station':\n\t\t\t\t\tentity = new Station(this);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tentity = new Entity(this);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tentity.load(entityConfig);\n\t\t\tthis.addEntity(entity);\n\t\t});\n\n\t\tif(config.bounds) {\n\t\t\tthis.bounds = config.bounds;\n\t\t}\n\t}\n\taddEntity(entity: Entity) {\n\t\tthis.entities.push(entity);\n\t\tentity.on('dead', () => {\n\t\t\tthis.removeEntity(entity);\n\t\t});\n\t\tthis.emit('entity-added', entity);\n\t}\n\tremoveEntity(entity: Entity) {\n\t\tlet index = this.entities.indexOf(entity);\n\t\tif(index !== -1) {\n\t\t\tthis.entities.splice(index, 1);\n\t\t}\n\t}\n\n\tupdate(delta: number) {\n\t\tthis.quadtree = new Quadtree({\n\t\t\twidth: this.bounds.width,\n\t\t\theight: this.bounds.height\n\t\t});\n\t\tthis.entities.forEach(entity => {\n\t\t\tthis.quadtree.insert(new Rectangle({\n\t\t\t\tx: entity.x,\n\t\t\t\ty: entity.y,\n\t\t\t\twidth: entity.width,\n\t\t\t\theight: entity.height,\n\t\t\t\tdata: {\n\t\t\t\t\tentity\n\t\t\t\t}\n\t\t\t}));\n\t\t});\n\n\t\tthis.entities.forEach(entity => {\n\t\t\tif(entity.dead) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tentity.update(delta);\n\t\t});\n\t}\n\n\tgetNearestEntity(entity: Entity, filter: (entity: Entity) => boolean) {\n\t\tlet rect = {\n\t\t\tx: entity.x - 50,\n\t\t\ty: entity.y - 50,\n\t\t\twidth: entity.width + 100,\n\t\t\theight: entity.height + 100\n\t\t};\n\n\t\t// TODO: At the beginning this is slow because we are in a clump of our own units so it returns a lot of results without any enemies\n\t\tlet entities = this.getEntitiesInRange(rect).filter(otherEntity => otherEntity !== entity && !otherEntity.dead && filter(otherEntity));\n\t\tif(entities.length === 0) {\n\t\t\trect.x -= 100;\n\t\t\trect.y -= 100;\n\t\t\trect.width += 200;\n\t\t\trect.height += 200;\n\t\t\tentities = this.getEntitiesInRange(rect).filter(otherEntity => otherEntity !== entity && filter(otherEntity));\n\t\t}\n\n\t\tentities.sort((a, b) => {\n\t\t\treturn euclideanDistance(a.x, a.y, entity.x, entity.y) - euclideanDistance(b.x, b.y, entity.x, entity.y);\n\t\t});\n\t\treturn entities[0] ?? null;\n\t}\n\tgetEntitiesInRange(range: { x: number, y: number, width: number, height: number }): Array<Entity> {\n\t\treturn this.quadtree.retrieve(new Rectangle(range)).map((result: any) => result.data.entity);\n\t}\n\n\tgetId() {\n\t\tthis.idCounter++;\n\t\treturn this.idCounter;\n\t}\n}","import { defineComponent as _defineComponent } from 'vue'\nimport { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, unref as _unref, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, normalizeStyle as _normalizeStyle, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\"\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-12587e64\"),n=n(),_popScopeId(),n)\nconst _hoisted_1 = { class: \"home\" }\nconst _hoisted_2 = { class: \"list\" }\nconst _hoisted_3 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(\"p\", null, null, -1))\nconst _hoisted_4 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(\"p\", null, null, -1))\nconst _hoisted_5 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(\"div\", { id: \"phaser-container-simple\" }, null, -1))\n\nimport { ref, onMounted, onBeforeUnmount, Ref } from 'vue';\nimport Phaser from 'phaser';\nimport World from './entities/world';\nimport Entity from './entities/entity';\nimport generateScene from '@/data/generate-scene';\nimport Station from './entities/station';\nimport Ship from './entities/ship';\n\n\nexport default /*#__PURE__*/_defineComponent({\n  setup(__props) {\n\nlet world = new World();\nconst startupTime = ref(0);\nconst minUpdateTime = ref(0);\nconst maxUpdateTime = ref(0);\nconst avgUpdateTime = ref(0);\nconst stationsCount = ref(0);\nconst shipsCount = ref(0);\nconst stationShips = ref([]) as Ref<Array<{ color: number, displayColor: string, ships: number }>>;\n\nlet game: Phaser.Game | null;\nonMounted(() => {\n\tlet updateTicks = 0;\n\tlet updateTimes: Array<number> = [];\n\n\tconst width = window.innerWidth / 3 * 2;\n\tconst height = window.innerHeight / 3 * 2;\n\tlet paused = false;\n\tgame = new Phaser.Game({\n\t\ttype: Phaser.AUTO,\n\t\twidth,\n\t\theight,\n\t\tparent: 'phaser-container-simple',\n\t\t// @ts-expect-error\n\t\tscene: {\n\t\t\tpreload() {\n\t\t\t\tthis.load.image('boid', 'boid.png');\n\t\t\t\tthis.load.image('station', 'station.png');\n\t\t\t\tthis.load.image('shield', 'shield3.png');\n\t\t\t},\n\t\t\tcreate() {\n\t\t\t\tworld.on('entity-added', (entity: Entity) => {\n\t\t\t\t\tlet image = this.add.image(entity.x, entity.y, entity.key) as any;\n\t\t\t\t\timage.setScale(entity.width / image.width, entity.height / image.height);\n\t\t\t\t\timage.shieldImage = this.add.image(entity.x, entity.y, 'shield');\n\t\t\t\t\timage.shieldImage.setScale(entity.width / image.shieldImage.width * 2, entity.height / image.shieldImage.height * 2);\n\t\t\t\t\timage.shieldImage.visible = entity.shields > 0;\n\t\t\t\t\tif(entity instanceof Station || entity instanceof Ship) {\n\t\t\t\t\t\timage.setTint(entity.color);\n\t\t\t\t\t}\n\n\t\t\t\t\t['x', 'y', 'angle'].forEach(prop => {\n\t\t\t\t\t\tentity.on(`${prop}-updated`, (newValue: any) => {\n\t\t\t\t\t\t\timage[prop] = newValue;\n\t\t\t\t\t\t\timage.shieldImage[prop] = newValue;\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tentity.on('dead', () => {\n\t\t\t\t\t\timage.destroy();\n\t\t\t\t\t\timage.shieldImage.destroy();\n\t\t\t\t\t});\n\t\t\t\t\tentity.on('shields-updated', (newValue: number) => {\n\t\t\t\t\t\timage.shieldImage.visible = newValue > 0;\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tlet start = performance.now();\n\t\t\t\tworld.load(generateScene({\n\t\t\t\t\tstations: 6,\n\t\t\t\t\tshipsPerStation: 100,\n\t\t\t\t\twidth,\n\t\t\t\t\theight\n\t\t\t\t}));\n\t\t\t\tlet end = performance.now();\n\t\t\t\tstartupTime.value = end - start;\n\n\t\t\t\tlet stations = world.entities.filter(entity => entity instanceof Station) as Array<Station>;\n\t\t\t\tstationShips.value = stations.map(station => {\n\t\t\t\t\tlet displayColor = '#' + station.color.toString(16);\n\t\t\t\t\tif(displayColor === '#ffffff') {\n\t\t\t\t\t\tdisplayColor = '#00000';\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcolor: station.color,\n\t\t\t\t\t\tdisplayColor,\n\t\t\t\t\t\tships: station.ships.length\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\t\tthis.input.keyboard.on('keydown-SPACE', () => {\n\t\t\t\t\tpaused = !paused;\n\t\t\t\t});\n\t\t\t},\n\t\t\tupdate(time: number, delta: number) {\n\t\t\t\tif(paused) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet start = performance.now();\n\t\t\t\tworld.update(delta / 1_000);\n\t\t\t\tlet end = performance.now();\n\n\t\t\t\tupdateTimes.push(end - start);\n\t\t\t\tupdateTicks += delta;\n\t\t\t\tif(updateTicks > 1_000) {\n\t\t\t\t\tminUpdateTime.value = updateTimes.reduce((min, time) => {\n\t\t\t\t\t\treturn Math.min(min, time);\n\t\t\t\t\t}, 1_000_000);\n\t\t\t\t\tmaxUpdateTime.value = updateTimes.reduce((max, time) => {\n\t\t\t\t\t\treturn Math.max(max, time);\n\t\t\t\t\t}, 0);\n\t\t\t\t\tavgUpdateTime.value = updateTimes.reduce((total, time) => {\n\t\t\t\t\t\treturn total + time;\n\t\t\t\t\t}, 0) / updateTimes.length;\n\t\t\t\t\tupdateTimes = [];\n\t\t\t\t\tupdateTicks = 0;\n\n\t\t\t\t\tstationsCount.value = world.entities.filter(entity => entity instanceof Station).length;\n\t\t\t\t\tshipsCount.value = world.entities.filter(entity => entity instanceof Ship).length;\n\n\t\t\t\t\tlet stations = world.entities.filter(entity => entity instanceof Station) as Array<Station>;\n\t\t\t\t\tstationShips.value.forEach(val => {\n\t\t\t\t\t\tlet matchingStation = stations.find(station => station.color === val.color);\n\t\t\t\t\t\tif(matchingStation) {\n\t\t\t\t\t\t\tval.ships = matchingStation.ships.length;\n\t\t\t\t\t\t} else if(val.ships > 0) {\n\t\t\t\t\t\t\t// paused = true;\n\t\t\t\t\t\t\tval.ships = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n});\nonBeforeUnmount(() => {\n\tif(game) {\n\t\tgame.destroy();\n\t\tgame = null;\n\t} \n});\n\nfunction addShips() {\n\tlet stations = world.entities.filter(entity => entity instanceof Station) as Array<Station>;\n\tstations.forEach(station => {\n\t\tstation.set('money', station.money + 10);\n\t});\n}\n\nreturn (_ctx: any,_cache: any) => {\n  return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n    _createElementVNode(\"div\", _hoisted_2, [\n      _createElementVNode(\"div\", null, \"Startup time: \" + _toDisplayString(startupTime.value.toFixed(2)) + \" ms\", 1),\n      _createElementVNode(\"div\", null, \"Update time: \" + _toDisplayString(minUpdateTime.value.toFixed(2)) + \" - \" + _toDisplayString(maxUpdateTime.value.toFixed(2)) + \" (\" + _toDisplayString(avgUpdateTime.value.toFixed(2)) + \" avg) ms\", 1),\n      _hoisted_3,\n      _createElementVNode(\"div\", null, \"Entities: \" + _toDisplayString(stationsCount.value) + \" stations and \" + _toDisplayString(shipsCount.value) + \" ships\", 1),\n      (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(stationShips), (station) => {\n        return (_openBlock(), _createElementBlock(\"div\", {\n          key: station.color,\n          style: _normalizeStyle({ color: station.displayColor })\n        }, _toDisplayString('#' + station.color.toString(16)) + \": \" + _toDisplayString(station.ships), 5))\n      }), 128)),\n      _hoisted_4,\n      _createElementVNode(\"button\", { onClick: addShips }, \"Add Ships\")\n    ]),\n    _hoisted_5\n  ]))\n}\n}\n\n})","export { default } from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??clonedRuleSet-41.use[2]!../../node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./SimpleGame.vue?vue&type=script&setup=true&lang=ts\"; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??clonedRuleSet-41.use[2]!../../node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./SimpleGame.vue?vue&type=script&setup=true&lang=ts\"","// extracted by mini-css-extract-plugin\nexport {};","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-12.use[0]!../../node_modules/css-loader/dist/cjs.js??clonedRuleSet-12.use[1]!../../node_modules/vue-loader/dist/stylePostLoader.js!../../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-12.use[2]!../../node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./SimpleGame.vue?vue&type=style&index=0&id=12587e64&scoped=true&lang=css\"","import script from \"./SimpleGame.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./SimpleGame.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./SimpleGame.vue?vue&type=style&index=0&id=12587e64&scoped=true&lang=css\"\n\nimport exportComponent from \"/home/runner/work/ecs-arraybuffer/ecs-arraybuffer/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-12587e64\"]])\n\nexport default __exports__"],"names":["EventEmitter","Entity","constructor","world","id","getId","load","config","Object","keys","forEach","key","update","delta","set","x","velocityX","y","velocityY","timeSinceTakenDamage","shields","maxShields","timeSinceShieldRegeneration","timeToRegenerateShields","prop","value","emit","die","dead","canTakeDamage","takeDamage","damage","computeAngle","distance","euclideanDistance","Station","PhaserMath","require","Ship","station","width","height","color","keepInBounds","nearesetEnemy","getNearestEnemy","Math","max","collide","force","getMoveTowardsForce","newVelocity","Vector2","normalize","speed","abs","bounds","getNearestEntity","entity","stations","entities","filter","sort","a","b","target","enemyWorth","ships","length","money","ship","random","push","on","index","indexOf","splice","addEntity","Quadtree","Rectangle","World","entityConfig","type","removeEntity","quadtree","insert","data","rect","getEntitiesInRange","otherEntity","range","retrieve","map","result","idCounter","defineComponent","_defineComponent","toDisplayString","_toDisplayString","createElementVNode","_createElementVNode","unref","_unref","renderList","_renderList","Fragment","_Fragment","openBlock","_openBlock","createElementBlock","_createElementBlock","normalizeStyle","_normalizeStyle","pushScopeId","_pushScopeId","popScopeId","_popScopeId","_withScopeId","n","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","ref","onMounted","onBeforeUnmount","Phaser","generateScene","setup","__props","startupTime","minUpdateTime","maxUpdateTime","avgUpdateTime","stationsCount","shipsCount","stationShips","game","updateTicks","updateTimes","window","innerWidth","innerHeight","paused","Game","AUTO","parent","scene","preload","image","create","add","setScale","shieldImage","visible","setTint","newValue","destroy","start","performance","now","shipsPerStation","end","displayColor","toString","input","keyboard","time","reduce","min","total","val","matchingStation","find","addShips","_ctx","_cache","toFixed","style","onClick"],"sourceRoot":""}