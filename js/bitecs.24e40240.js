"use strict";(self["webpackChunkecs_arraybuffer"]=self["webpackChunkecs_arraybuffer"]||[]).push([[816],{3305:function(e,t,o){o.r(t),o.d(t,{default:function(){return Bt}});var n=o(3396),i=o(7139),s=o(4870),r=o(3836),l=o.n(r),h=o(238),a=o(2482),c=(o(8675),o(3462),o(1703),o(6699),{i8:"i8",ui8:"ui8",ui8c:"ui8c",i16:"i16",ui16:"ui16",i32:"i32",ui32:"ui32",f32:"f32",f64:"f64",eid:"eid"}),d={i8:"Int8",ui8:"Uint8",ui8c:"Uint8Clamped",i16:"Int16",ui16:"Uint16",i32:"Int32",ui32:"Uint32",eid:"Uint32",f32:"Float32",f64:"Float64"},m={i8:Int8Array,ui8:Uint8Array,ui8c:Uint8ClampedArray,i16:Int16Array,ui16:Uint16Array,i32:Int32Array,ui32:Uint32Array,f32:Float32Array,f64:Float64Array,eid:Uint32Array},u={uint8:256,uint16:65536,uint32:2**32},y=e=>t=>Math.ceil(t/e)*e,p=y(4),f=Symbol("storeRef"),g=Symbol("storeSize"),w=Symbol("storeMaps"),S=Symbol("storeFlattened"),b=Symbol("storeBase"),v=Symbol("storeType"),E=Symbol("storeArrayElementCounts"),x=Symbol("storeSubarrays"),k=Symbol("subarrayCursors"),A=Symbol("subarray"),T=(Symbol("subarrayFrom"),Symbol("subarrayTo"),Symbol("parentArray")),M=Symbol("tagStore"),R=(Symbol("queryShadow"),Symbol("serializeShadow"),Symbol("indexType")),C=Symbol("indexBytes"),I=Symbol("isEidType"),_={},Z=(e,t)=>{const o=new ArrayBuffer(t*e.BYTES_PER_ELEMENT),n=new e.constructor(o);return n.set(e,0),n},O=(e,t)=>{if(ArrayBuffer.isView(e))e[t]=e.slice(0);else{const o=e[T].slice(0);e[t]=e.map(((t,n)=>{const{length:i}=e[n],s=i*n,r=s+i;return o.subarray(s,r)}))}},j=(e,t,o)=>{const n=e[k];let i=t[v];const s=t[0].length,r=s<=u.uint8?c.ui8:s<=u.uint16?c.ui16:c.ui32;if(0===n[i]){const t=e[E][i],n=new m[i](p(t*o));n.set(e[x][i]),e[x][i]=n,n[R]=d[r],n[C]=m[r].BYTES_PER_ELEMENT}const l=n[i],h=l+o*s;n[i]=h,t[T]=e[x][i].subarray(l,h);for(let a=0;a<o;a++){const e=s*a,o=e+s;t[a]=t[T].subarray(e,o),t[a][R]=d[r],t[a][C]=m[r].BYTES_PER_ELEMENT,t[a][A]=!0}},z=(e,t,o)=>{Object.keys(t).forEach((n=>{const i=t[n];Array.isArray(i)?(j(e,i,o),t[S].push(i)):ArrayBuffer.isView(i)?(t[n]=Z(i,o),t[S].push(t[n])):"object"===typeof i&&z(e,t[n],o)}))},U=(e,t)=>{e[M]||(e[g]=t,e[S].length=0,Object.keys(e[k]).forEach((t=>{e[k][t]=0})),z(e,e,t))},B=(e,t)=>{e[S]&&e[S].forEach((e=>{ArrayBuffer.isView(e)?e[t]=0:e[t].fill(0)}))},q=(e,t)=>{const o=t*m[e].BYTES_PER_ELEMENT,n=new ArrayBuffer(o),i=new m[e](n);return i[I]=e===c.eid,i},D=(e,t,o)=>{const n=e[g],i=Array(n).fill(0);i[v]=t,i[I]=t===c.eid;const s=e[k],r=o<=u.uint8?c.ui8:o<=u.uint16?c.ui16:c.ui32;if(!o)throw new Error("bitECS - Must define component array length");if(!m[t])throw new Error(`bitECS - Invalid component array property type ${t}`);if(!e[x][t]){const o=e[E][t],i=new m[t](p(o*n));i[R]=d[r],i[C]=m[r].BYTES_PER_ELEMENT,e[x][t]=i}const l=s[t],h=l+n*o;s[t]=h,i[T]=e[x][t].subarray(l,h);for(let a=0;a<n;a++){const e=o*a,t=e+o;i[a]=i[T].subarray(e,t),i[a][R]=d[r],i[a][C]=m[r].BYTES_PER_ELEMENT,i[a][A]=!0}return i},P=e=>Array.isArray(e)&&"string"===typeof e[0]&&"number"===typeof e[1],Y=(e,t)=>{const o=Symbol("store");if(!e||!Object.keys(e).length)return _[o]={[g]:t,[M]:!0,[b]:()=>_[o]},_[o];e=JSON.parse(JSON.stringify(e));const n={},i=e=>{const t=Object.keys(e);for(const o of t)P(e[o])?(n[e[o][0]]||(n[e[o][0]]=0),n[e[o][0]]+=e[o][1]):e[o]instanceof Object&&i(e[o])};i(e);const s={[g]:t,[w]:{},[x]:{},[f]:o,[k]:Object.keys(m).reduce(((e,t)=>({...e,[t]:0})),{}),[S]:[],[E]:n};if(e instanceof Object&&Object.keys(e).length){const n=(e,i)=>{if("string"===typeof e[i])e[i]=q(e[i],t),e[i][b]=()=>_[o],s[S].push(e[i]);else if(P(e[i])){const[t,n]=e[i];e[i]=D(s,t,n),e[i][b]=()=>_[o],s[S].push(e[i])}else e[i]instanceof Object&&(e[i]=Object.keys(e[i]).reduce(n,e[i]));return e};return _[o]=Object.assign(Object.keys(e).reduce(n,e),s),_[o][b]=()=>_[o],_[o]}},F=()=>{const e=[],t=[];e.sort=function(o){const n=Array.prototype.sort.call(this,o);for(let i=0;i<e.length;i++)t[e[i]]=i;return n};const o=o=>e[t[o]]===o,n=n=>{o(n)||(t[n]=e.push(n)-1)},i=n=>{if(!o(n))return;const i=t[n],s=e.pop();s!==n&&(e[i]=s,t[s]=i)};return{add:n,remove:i,has:o,sparse:t,dense:e}},H=e=>{e},N=e=>t=>!e(t),L=e=>e[S],Q=L,V=(N(Q),e=>"function"===typeof e),X=(N(V),Symbol("entityMasks")),$=Symbol("entityComponents"),J=Symbol("entitySparseSet"),G=Symbol("entityArray"),K=(Symbol("entityIndices"),Symbol("removedEntities"),1e5),W=0,ee=K,te=()=>ee-ee/5,oe=()=>ee,ne=[],ie=()=>{ee=K,W=0,ne.length=0},se=e=>{const t=ee;K=e,ie(),ee=e,Xe(e),ze(e),H(!0),console.info(`ðŸ‘¾ bitECS - resizing all data stores from ${t} to ${e}`)},re=()=>W,le=new Map,he=e=>{if(W>=te()){const e=ee,t=4*Math.ceil(e/2/4);se(e+t)}const t=ne.length>Math.round(.01*K)?ne.shift():W++;return e[J].add(t),le.set(t,e),e[pe].forEach((o=>{const n=Re(e,o,t);n&&Ce(o,t)})),e[$].set(t,new Set),t},ae=(e,t)=>{if(e[J].has(t)){e[ye].forEach((o=>{Ze(e,o,t)})),ne.push(t),e[J].remove(t),e[$].delete(t),e[Le].delete(e[Qe].get(t)),e[Qe].delete(t);for(let o=0;o<e[X].length;o++)e[X][o][t]=0}};function ce(e){return()=>[e,"changed"]}function de(...e){return function(){return e}}function me(...e){return function(){return e}}function ue(...e){return function(){return e}}var ye=Symbol("queries"),pe=Symbol("notQueries"),fe=Symbol("queryAny"),ge=Symbol("queryAll"),we=Symbol("queryNone"),Se=Symbol("queryMap"),be=Symbol("$dirtyQueries"),ve=Symbol("queryComponents"),Ee=(Symbol("enterQuery"),Symbol("exitQuery"),(e,t)=>{const o=[],n=[],i=[];t[ve].forEach((t=>{if("function"===typeof t){const[s,r]=t();e[Oe].has(s)||qe(e,s),"not"===r&&n.push(s),"changed"===r&&(i.push(s),o.push(s))}else e[Oe].has(t)||qe(e,t),o.push(t)}));const s=t=>e[Oe].get(t),r=o.concat(n).map(s),l=F(),h=[],a=[],c=F(),d=F(),m=F(),u=r.map((e=>e.generationId)).reduce(((e,t)=>(e.includes(t)||e.push(t),e)),[]),y=(e,t)=>(e[t.generationId]||(e[t.generationId]=0),e[t.generationId]|=t.bitflag,e),p=o.map(s).reduce(y,{}),f=n.map(s).reduce(y,{}),g=r.reduce(y,{}),w=o.filter((e=>!e[M])).map((e=>Object.getOwnPropertySymbols(e).includes(S)?e[S]:[e])).reduce(((e,t)=>e.concat(t)),[]),b=[],v=Object.assign(l,{archetypes:h,changed:a,components:o,notComponents:n,changedComponents:i,allComponents:r,masks:p,notMasks:f,hasMasks:g,generations:u,flatProps:w,toRemove:c,entered:d,exited:m,shadows:b});e[Se].set(t,v),e[ye].add(v),r.forEach((e=>{e.queries.add(v)})),n.length&&e[pe].add(v);for(let S=0;S<re();S++){if(!e[J].has(S))continue;const t=Re(e,v,S);t&&Ce(v,S)}}),xe=(e,t)=>{const o=Symbol(),n=e.flatProps[t];return O(n,o),e.shadows[t]=n[o],n[o]},ke=(e,t)=>{t&&(e.changed=[]);const{flatProps:o,shadows:n}=e;for(let i=0;i<e.dense.length;i++){const t=e.dense[i];let s=!1;for(let i=0;i<o.length;i++){const r=o[i],l=n[i]||xe(e,i);if(ArrayBuffer.isView(r[t])){for(let e=0;e<r[t].length;e++)if(r[t][e]!==l[t][e]){s=!0;break}l[t].set(r[t])}else r[t]!==l[t]&&(s=!0,l[t]=r[t])}s&&e.changed.push(t)}return e.changed},Ae=(e,t)=>e.concat(t),Te=e=>t=>t.filter((t=>t.name===e().constructor.name)).reduce(Ae),Me=(Te(de),Te(me),Te(ue),(...e)=>{let t,o,n,i;if(Array.isArray(e[0])&&(t=e[0]),void 0===t||void 0!==t[Oe])return e=>e?e[G]:t[G];const s=function(e,t=!0){e[Se].has(s)||Ee(e,s);const o=e[Se].get(s);return _e(e),o.changedComponents.length?ke(o,t):o.dense};return s[ve]=t,s[fe]=o,s[ge]=n,s[we]=i,s}),Re=(e,t,o)=>{const{masks:n,notMasks:i,generations:s}=t;for(let r=0;r<s.length;r++){const t=s[r],l=n[t],h=i[t],a=e[X][t][o];if(h&&0!==(a&h))return!1;if(l&&(a&l)!==l)return!1}return!0},Ce=(e,t)=>{e.toRemove.remove(t),e.entered.add(t),e.add(t)},Ie=e=>{for(let t=e.toRemove.dense.length-1;t>=0;t--){const o=e.toRemove.dense[t];e.toRemove.remove(o),e.remove(o)}},_e=e=>{e[be].size&&(e[be].forEach(Ie),e[be].clear())},Ze=(e,t,o)=>{t.has(o)&&!t.toRemove.has(o)&&(t.toRemove.add(o),e[be].add(t),t.exited.add(o))},Oe=Symbol("componentMap"),je=[],ze=e=>{je.forEach((t=>U(t,e)))},Ue=(e,t)=>{const o=Y(e,t||oe());return e&&Object.keys(e).length&&je.push(o),o},Be=e=>{e[He]*=2,e[He]>=2**31&&(e[He]=1,e[X].push(new Uint32Array(e[Ye])))},qe=(e,t)=>{if(!t)throw new Error("bitECS - Cannot register null or undefined component");const o=new Set,n=new Set,i=new Set;e[ye].forEach((e=>{e.allComponents.includes(t)&&o.add(e)})),e[Oe].set(t,{generationId:e[X].length-1,bitflag:e[He],store:t,queries:o,notQueries:n,changedQueries:i}),t[g]<oe()&&U(t,oe()),Be(e)},De=(e,t,o)=>{const n=e[Oe].get(t);if(!n)return!1;const{generationId:i,bitflag:s}=n,r=e[X][i][o];return(r&s)===s},Pe=(e,t,o,n=!1)=>{if(void 0===o)throw new Error("bitECS - entity is undefined.");if(!e[J].has(o))throw new Error("bitECS - entity does not exist in the world.");if(e[Oe].has(t)||qe(e,t),De(e,t,o))return;const i=e[Oe].get(t),{generationId:s,bitflag:r,queries:l,notQueries:h}=i;e[X][s][o]|=r,l.forEach((t=>{t.toRemove.has(o)&&t.toRemove.remove(o);const n=Re(e,t,o);n&&Ce(t,o),n||Ze(e,t,o)})),e[$].get(o).add(t),n&&B(t,o)},Ye=Symbol("size"),Fe=Symbol("resizeThreshold"),He=Symbol("bitflag"),Ne=Symbol("archetypes"),Le=Symbol("localEntities"),Qe=Symbol("localEntityLookp"),Ve=[],Xe=e=>{Ve.forEach((t=>{t[Ye]=e;for(let o=0;o<t[X].length;o++){const n=t[X][o];t[X][o]=Z(n,e)}t[Fe]=t[Ye]-t[Ye]/5}))},$e=(...e)=>{const t="object"===typeof e[0]?e[0]:{},o="number"===typeof e[0]?e[0]:"number"===typeof e[1]?e[1]:oe();return Je(t,o),Ve.push(t),t},Je=(e,t=oe())=>(e[Ye]=t,e[G]&&e[G].forEach((t=>ae(e,t))),e[X]=[new Uint32Array(t)],e[$]=new Map,e[Ne]=[],e[J]=F(),e[G]=e[J].dense,e[He]=1,e[Oe]=new Map,e[Se]=new Map,e[ye]=new Set,e[pe]=new Set,e[be]=new Set,e[Le]=new Map,e[Qe]=new Map,e),Ge=c,Ke=o(6856);class We extends Ke.EventEmitter{get x(){return this.world.components.position.x[this.eid]}set x(e){this.world.components.position.x[this.eid]=e}get y(){return this.world.components.position.y[this.eid]}set y(e){this.world.components.position.y[this.eid]=e}get width(){return this.world.components.position.width[this.eid]}set width(e){this.world.components.position.width[this.eid]=e}get height(){return this.world.components.position.height[this.eid]}set height(e){this.world.components.position.height[this.eid]=e}get shields(){return this.world.components.health.shields[this.eid]}set shields(e){this.world.components.health.shields[this.eid]=e}get maxShields(){return this.world.components.health.maxShields[this.eid]}set maxShields(e){this.world.components.health.maxShields[this.eid]=e}get timeToRegenerateShields(){return this.world.components.health.timeToRegenerateShields[this.eid]}set timeToRegenerateShields(e){this.world.components.health.timeToRegenerateShields[this.eid]=e}get timeSinceShieldRegeneration(){return this.world.components.health.timeSinceShieldRegeneration[this.eid]}set timeSinceShieldRegeneration(e){this.world.components.health.timeSinceShieldRegeneration[this.eid]=e}get timeSinceTakenDamage(){return this.world.components.health.timeSinceTakenDamage[this.eid]}set timeSinceTakenDamage(e){this.world.components.health.timeSinceTakenDamage[this.eid]=e}get dead(){return this.world.components.health.shields[this.eid]}set dead(e){this.world.components.health.shields[this.eid]=e}constructor(e){super(),(0,a.Z)(this,"world",void 0),(0,a.Z)(this,"eid",void 0),(0,a.Z)(this,"type","entity"),(0,a.Z)(this,"key","boid"),this.eid=he(e.ecs),this.world=e,this.addComponent(e.components.position),this.addComponent(e.components.health),this.shields=1,this.maxShields=1,this.timeToRegenerateShields=1,this.timeSinceShieldRegeneration=0,this.timeSinceTakenDamage=0,this.dead=0}load(e){Object.keys(e).forEach((t=>{this[t]=e[t]}))}set(e,t,o){this.world.components[e][t][this.eid]=o}addComponent(e){Pe(this.world.ecs,e,this.eid)}}class et extends We{get color(){return this.world.components.controller.color[this.eid]}set color(e){this.world.components.controller.color[this.eid]=e}get money(){return this.world.components.controller.money[this.eid]}set money(e){this.world.components.controller.money[this.eid]=e}constructor(e){super(e),this.addComponent(e.components.controller),this.key="station",this.width=20,this.height=20,this.shields=2,this.maxShields=2,this.timeToRegenerateShields=5}}var tt=o(2254);class ot extends We{get color(){return this.world.components.controller.color[this.world.components.controlled.owner[this.eid]]}get velocityX(){return this.world.components.velocity.x[this.eid]}set velocityX(e){this.world.components.velocity.x[this.eid]=e}get velocityY(){return this.world.components.velocity.y[this.eid]}set velocityY(e){this.world.components.velocity.y[this.eid]=e}get station(){return this.world.getEntity(this.eid)}constructor(e){super(e.world);let t=e.world;this.addComponent(t.components.velocity),this.addComponent(t.components.controlled),this.addComponent(t.components.attack),this.width=10,this.height=5,this.shields=1,this.maxShields=1,this.timeToRegenerateShields=1,this.world.components.velocity.speed[this.eid]=100,t.components.controlled.owner[this.eid]=e.eid}}function nt(e){const t=e.components.controller,o=e.components.health;let n=Me([t]);return i=>{let s=n(i).filter((e=>!o.dead[e]));return s.forEach((o=>{let n=e.getEntity(o);if(t.money[o]>0){let i=new ot(n);i.x=n.x,i.y=n.y,i.velocityX=Math.random(),i.velocityY=Math.random(),e.components.position.angle[i.eid]=(0,tt.Z)(i.velocityX,i.velocityY),e.addEntity(i),t.money[o]--}})),i}}var it={x:Ge.f32,y:Ge.f32,width:Ge.f32,height:Ge.f32,angle:Ge.f32},st={color:Ge.f32,money:Ge.i32},rt={x:Ge.f32,y:Ge.f32,speed:Ge.f32},lt={shields:Ge.i32,maxShields:Ge.i32,timeToRegenerateShields:Ge.f32,timeSinceShieldRegeneration:Ge.f32,timeSinceTakenDamage:Ge.f32,dead:Ge.ui8},ht={owner:Ge.eid},at={target:Ge.eid},ct={position:Ue(it),controller:Ue(st),velocity:Ue(rt),health:Ue(lt),controlled:Ue(ht),attack:Ue(at)};function dt(e){const t=e.components.position,o=e.components.velocity;let n=Me([t,o]);return(i,s)=>{let r=n(i);return r.forEach((n=>{t.x[n]+=o.x[n]*s,t.y[n]+=o.y[n]*s,(t.x[n]<0||t.x[n]>e.bounds.width)&&(o.x[n]=-o.x[n],t.angle[n]=(0,tt.Z)(o.x[n],o.y[n])),(t.y[n]<0||t.y[n]>e.bounds.height)&&(o.y[n]=-o.y[n],t.angle[n]=(0,tt.Z)(o.x[n],o.y[n]))})),i}}var mt=o(8973),ut=o(6065);function yt(e){const t=e.components.position,o=e.components.velocity,n=e.components.controlled,i=e.components.controller,s=e.components.health;let r=Me([o]);const l=.03;let h=l+1,a=[],c=0;return(d,m)=>{h+=m,h>l&&0===a.length&&(a=r(d).filter((e=>!s.dead[e])),c=a.length/2,h=0);let u=d.quadtree,y=performance.now();for(let s=0;s<a.length;s++){let r=a[s],l=u.retrieve(new mt.A({x:t.x[r],y:t.y[r],width:t.width[r],height:t.height[r]})).map((e=>e.data.eid)).filter((e=>e!==r)),h=i.color[n.owner[r]],p=l.filter((e=>{if(De(d,n,e)){let t=n.owner[e];return i.color[t]!==h}return!!De(d,i,e)&&i.color[e]!==h})),f=p.filter((e=>(0,ut.Z)(t.x[e],t.y[e],t.x[r],t.y[r])<Math.max(t.width[r],t.width[e])));if(f.length&&(pt(e,a,r,f[0]),o.x[r]=-o.x[r],o.y[r]=-o.y[r],t.angle[r]=(0,tt.Z)(o.x[r],o.y[r])),s%10===0&&s>c&&performance.now()-y>1e3*m/2)return a=a.slice(s),d}return a=[],d}}function pt(e,t,o,n){if(!gt(e,o)||!gt(e,n))return;let i=1;De(e.ecs,e.components.controller,n)&&(i=t.filter((t=>e.components.controlled.owner[t]===n)).length),ft(e,t,o,1),ft(e,t,n,1);const s=e.components.controlled;if(e.components.health.dead[n]){let t=s.owner[o];e.components.controller.money[t]+=i}if(e.components.health.dead[o])if(De(e.ecs,s,n)){let t=s.owner[n];e.components.controller.money[t]+=1}else De(e.ecs,e.components.controller,n)&&(e.components.controller.money[n]+=1)}function ft(e,t,o,n){const i=e.components.health;if(i.shields[o]-=n,i.timeSinceTakenDamage[o]=0,i.shields[o]<0&&(i.dead[o]=1,De(e.ecs,e.components.controller,o))){let n=t.filter((t=>e.components.controlled.owner[t]===o));n.forEach((e=>{i.dead[e]=1}))}}function gt(e,t){return e.components.health.timeSinceTakenDamage[t]>=.2}var wt=o(1396);function St(e){const t=e.components.position,o=e.components.velocity,n=e.components.controlled,i=e.components.controller,s=e.components.health,r=e.components.attack;let l=Me([o,r]),h=Me([i]);const a=.2;let c=a+1,d=[],m=0;return(o,u)=>{c+=u,c>a&&0===d.length&&(d=l(o).filter((e=>!s.dead[e])),m=d.length/(a/u),c=0);let y=o.quadtree,p=performance.now();for(let l=0;l<d.length;l++){let a=d[l],c=i.color[n.owner[a]],f={x:t.x[a]-50,y:t.y[a]-50,width:t.width[a]+100,height:t.height[a]+100},g=bt(y,o,f,a,c,e);0===g.length&&(f.x-=100,f.y-=100,f.width+=200,f.height+=200,g=bt(y,o,f,a,c,e)),g.sort(((e,o)=>(0,wt.Z)(t.x[e],t.y[e],t.x[a],t.y[a])-(0,wt.Z)(t.x[o],t.y[o],t.x[a],t.y[a])));let w=g[0]??0;if(!w){let e=h(o).filter((e=>i.color[e]!==c&&!s.dead[e]));e.sort(((e,o)=>(0,wt.Z)(t.x[e],t.y[e],t.x[a],t.y[a])-(0,wt.Z)(t.x[o],t.y[o],t.x[a],t.y[a]))),w=e[0]??0}if(r.target[a]=w,l%10===0&&l>m&&performance.now()-p>1e3*u/2)return d=d.slice(l),o}return d=[],o}}function bt(e,t,o,n,i,s){const r=s.components.controlled,l=s.components.controller;let h=e.retrieve(new mt.A(o)).map((e=>e.data.eid)).filter((e=>e!==n));return h.filter((e=>{if(De(t,r,e)){let t=r.owner[e];return l.color[t]!==i}return!!De(t,l,e)&&l.color[e]!==i}))}var vt=o(7309);function Et(e){const t=e.components.position,o=e.components.health;let n=Me([t,o]);return i=>{let s=new vt.l({width:e.bounds.width,height:e.bounds.height});return n(i).forEach((e=>{o.dead[e]||s.insert(new mt.A({x:t.x[e],y:t.y[e],width:t.width[e],height:t.height[e],data:{eid:e}}))})),i.quadtree=s,i}}function xt(e){const t=e.components.health;let o=Me([t]);return(e,n)=>(o(e).forEach((e=>{t.timeSinceTakenDamage[e]+=n,t.shields[e]<t.maxShields[e]&&(t.timeSinceShieldRegeneration[e]+=n,t.timeSinceShieldRegeneration[e]>t.timeToRegenerateShields[e]&&(t.shields[e]++,t.timeSinceShieldRegeneration[e]=0))})),e)}const kt=o(3129);function At(e){const t=e.components.position,o=e.components.velocity,n=e.components.attack,i=e.components.health;let s=Me([o,n]);return e=>(s(e).forEach((e=>{let s=n.target[e];if(!s||i.dead[s])return;let r=Tt(t,e,s),l=new kt.Vector2(o.x[e]+2*r.x,o.y[e]+2*r.y);l.normalize(),o.x[e]=l.x*o.speed[e],o.y[e]=l.y*o.speed[e],t.angle[e]=(0,tt.Z)(o.x[e],o.y[e])})),e)}function Tt(e,t,o){let n=new kt.Vector2(e.x[o]-e.x[t],e.y[o]-e.y[t]);return n.normalize(),n}class Mt extends Ke.EventEmitter{get entities(){return[...this.eidMap.values()]}constructor(){super(),(0,a.Z)(this,"ecs",void 0),(0,a.Z)(this,"eidMap",new Map),(0,a.Z)(this,"bounds",{width:0,height:0}),(0,a.Z)(this,"components",ct),(0,a.Z)(this,"systems",[]),this.ecs=$e(),this.systems.push(Et(this)),this.systems.push(nt(this)),this.systems.push(St(this)),this.systems.push(At(this)),this.systems.push(dt(this)),this.systems.push(yt(this)),this.systems.push(xt(this))}load(e){e.entities.forEach((e=>{let t;switch(e.type){case"station":t=new et(this);break;default:t=new We(this);break}t.load(e),this.addEntity(t)})),e.bounds&&(this.bounds=e.bounds)}addEntity(e){this.emit("entity-added",e),this.eidMap.set(e.eid,e)}removeEntity(e){ae(this.ecs,e),this.eidMap.delete(e)}getEntity(e){return this.eidMap.get(e)??null}update(e){this.systems.forEach((t=>{t(this.ecs,e)}))}}const Rt=e=>((0,n.dD)("data-v-08fe5bbc"),e=e(),(0,n.Cn)(),e),Ct={class:"home"},It={class:"list"},_t=Rt((()=>(0,n._)("p",null,null,-1))),Zt=Rt((()=>(0,n._)("p",null,null,-1))),Ot=Rt((()=>(0,n._)("div",{id:"phaser-container-bitecs"},null,-1)));var jt=(0,n.aZ)({setup(e){let t=new Mt;const o=(0,s.iH)(0),r=(0,s.iH)(0),a=(0,s.iH)(0),c=(0,s.iH)(0),d=(0,s.iH)(0),m=(0,s.iH)(0),u=(0,s.iH)([]),y=Me([ct.controller]);let p;function f(){y(t.ecs).forEach((e=>{t.components.controller.money[e]+=10}))}return(0,n.bv)((()=>{let e=0,n=[];const i=window.innerWidth/3*2,s=window.innerHeight/3*2;let f=!1;const g=Me([ce(ct.position)]),w=Me([ce(ct.health)]),S=Me([ct.controlled]),b=new Map;p=new(l().Game)({type:l().AUTO,width:i,height:s,parent:"phaser-container-bitecs",scene:{preload(){this.load.image("boid","boid.png"),this.load.image("station","station.png"),this.load.image("shield","shield3.png")},create(){t.on("entity-added",(e=>{let t=this.add.image(e.x,e.y,e.key);t.setScale(e.width/t.width,e.height/t.height),t.shieldImage=this.add.image(e.x,e.y,"shield"),t.shieldImage.setScale(e.width/t.shieldImage.width*2,e.height/t.shieldImage.height*2),t.shieldImage.visible=e.shields>0,(e instanceof et||e instanceof ot)&&t.setTint(e.color),b.set(e.eid,t)}));let e=performance.now();t.load((0,h.Z)({stations:6,shipsPerStation:100,width:i,height:s}));let n=performance.now();o.value=n-e;let r=t.entities.filter((e=>e instanceof et));u.value=r.map((e=>{let t="#"+e.color.toString(16);return"#ffffff"===t&&(t="#00000"),{eid:e.eid,color:e.color,displayColor:t,ships:0}})),this.input.keyboard.on("keydown-SPACE",(()=>{f=!f}))},update(o,i){if(f)return;let s=performance.now();t.update(i/1e3),g(t.ecs).forEach((e=>{let t=b.get(e);t&&(t.x=t.shieldImage.x=ct.position.x[e],t.y=t.shieldImage.y=ct.position.y[e],t.angle=t.shieldImage.angle=ct.position.angle[e])})),w(t.ecs).forEach((e=>{let t=b.get(e);t&&(t.shieldImage.visible=ct.health.shields[e]>0,ct.health.dead[e]&&(t.destroy(),t.shieldImage.destroy(),b.delete(e)))}));let l=performance.now();if(n.push(l-s),e+=i,e>1e3){r.value=n.reduce(((e,t)=>Math.min(e,t)),1e6),a.value=n.reduce(((e,t)=>Math.max(e,t)),0),c.value=n.reduce(((e,t)=>e+t),0)/n.length,n=[],e=0,d.value=t.entities.filter((e=>e instanceof et)).length;let o=y(t.ecs).filter((e=>!ct.health.dead[e])),i=S(t.ecs).filter((e=>!ct.health.dead[e]));m.value=i.length,u.value.forEach((e=>{let t=o.find((t=>ct.controller.color[t]===e.color));void 0!==t?e.ships=i.filter((t=>ct.controlled.owner[t]===e.eid)).length:e.ships>0&&(e.ships=0)}))}}}})})),(0,n.Jd)((()=>{p&&(p.destroy(),p=null)})),(e,t)=>((0,n.wg)(),(0,n.iD)("div",Ct,[(0,n._)("div",It,[(0,n._)("div",null,"Startup time: "+(0,i.zw)(o.value)+" ms",1),(0,n._)("div",null,"Update time: "+(0,i.zw)(r.value.toFixed(2))+" - "+(0,i.zw)(a.value.toFixed(2))+" ("+(0,i.zw)(c.value.toFixed(2))+" avg) ms",1),_t,(0,n._)("div",null,"Entities: "+(0,i.zw)(d.value)+" stations and "+(0,i.zw)(m.value)+" ships",1),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)((0,s.SU)(u),(e=>((0,n.wg)(),(0,n.iD)("div",{key:e.color,style:(0,i.j5)({color:e.displayColor})},(0,i.zw)("#"+e.color.toString(16))+": "+(0,i.zw)(e.ships),5)))),128)),Zt,(0,n._)("button",{onClick:f},"Add Ships")]),Ot]))}}),zt=o(89);const Ut=(0,zt.Z)(jt,[["__scopeId","data-v-08fe5bbc"]]);var Bt=Ut}}]);
//# sourceMappingURL=bitecs.24e40240.js.map