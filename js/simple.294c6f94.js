"use strict";(self["webpackChunkecs_sharedarraybuffer_playground"]=self["webpackChunkecs_sharedarraybuffer_playground"]||[]).push([[899],{7309:function(t,e,i){i.d(e,{l:function(){return h}});var s=i(2482);class h{constructor(t,e=0){(0,s.Z)(this,"bounds",void 0),(0,s.Z)(this,"maxObjects",void 0),(0,s.Z)(this,"maxLevels",void 0),(0,s.Z)(this,"level",void 0),(0,s.Z)(this,"objects",void 0),(0,s.Z)(this,"nodes",void 0),this.bounds={x:t.x||0,y:t.y||0,width:t.width,height:t.height},this.maxObjects="number"===typeof t.maxObjects?t.maxObjects:10,this.maxLevels="number"===typeof t.maxLevels?t.maxLevels:4,this.level=e,this.objects=[],this.nodes=[]}getIndex(t){return t.qtIndex(this.bounds)}split(){const t=this.level+1,e=this.bounds.width/2,i=this.bounds.height/2,s=this.bounds.x,n=this.bounds.y,o=[{x:s+e,y:n},{x:s,y:n},{x:s,y:n+i},{x:s+e,y:n+i}];for(let a=0;a<4;a++)this.nodes[a]=new h({x:o[a].x,y:o[a].y,width:e,height:i,maxObjects:this.maxObjects,maxLevels:this.maxLevels},t)}insert(t){if(this.nodes.length){const e=this.getIndex(t);for(let i=0;i<e.length;i++)this.nodes[e[i]].insert(t)}else if(this.objects.push(t),this.objects.length>this.maxObjects&&this.level<this.maxLevels){this.nodes.length||this.split();for(let t=0;t<this.objects.length;t++){const e=this.getIndex(this.objects[t]);for(let i=0;i<e.length;i++)this.nodes[e[i]].insert(this.objects[t])}this.objects=[]}}retrieve(t){const e=this.getIndex(t);let i=this.objects;if(this.nodes.length)for(let s=0;s<e.length;s++)i=i.concat(this.nodes[e[s]].retrieve(t));return i=i.filter((function(t,e){return i.indexOf(t)>=e})),i}clear(){this.objects=[];for(let t=0;t<this.nodes.length;t++)this.nodes.length&&this.nodes[t].clear();this.nodes=[]}}},8973:function(t,e,i){i.d(e,{A:function(){return h}});var s=i(2482);class h{constructor(t){(0,s.Z)(this,"x",void 0),(0,s.Z)(this,"y",void 0),(0,s.Z)(this,"width",void 0),(0,s.Z)(this,"height",void 0),(0,s.Z)(this,"data",void 0),this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.data=t.data}qtIndex(t){const e=[],i=t.x+t.width/2,s=t.y+t.height/2,h=this.y<s,n=this.x<i,o=this.x+this.width>i,a=this.y+this.height>s;return h&&o&&e.push(0),n&&h&&e.push(1),n&&a&&e.push(2),o&&a&&e.push(3),e}}},6065:function(t,e,i){function s(t,e,i,s){return Math.sqrt((t-i)**2+(e-s)**2)}i.d(e,{Z:function(){return s}})},1396:function(t,e,i){function s(t,e,i,s){return(t-i)**2+(e-s)**2}i.d(e,{Z:function(){return s}})},6115:function(t,e,i){i.r(e),i.d(e,{default:function(){return M}});var s=i(3396),h=i(7139),n=i(4870),o=i(3836),a=i.n(o),d=i(2482),l=i(6856);class r extends l.EventEmitter{constructor(t){super(),(0,d.Z)(this,"world",void 0),(0,d.Z)(this,"id",void 0),(0,d.Z)(this,"x",0),(0,d.Z)(this,"y",0),(0,d.Z)(this,"width",0),(0,d.Z)(this,"height",0),(0,d.Z)(this,"angle",0),(0,d.Z)(this,"velocityX",0),(0,d.Z)(this,"velocityY",0),(0,d.Z)(this,"type","entity"),(0,d.Z)(this,"key","boid"),(0,d.Z)(this,"shields",1),(0,d.Z)(this,"maxShields",1),(0,d.Z)(this,"timeToRegenerateShields",1),(0,d.Z)(this,"timeSinceShieldRegeneration",0),(0,d.Z)(this,"timeSinceTakenDamage",0),(0,d.Z)(this,"dead",!1),this.world=t,this.id=t.getId()}load(t){Object.keys(t).forEach((e=>{this[e]=t[e]}))}update(t){this.set("x",this.x+this.velocityX*t),this.set("y",this.y+this.velocityY*t),this.set("timeSinceTakenDamage",this.timeSinceTakenDamage+t),this.shields<this.maxShields&&(this.set("timeSinceShieldRegeneration",this.timeSinceShieldRegeneration+t),this.timeSinceShieldRegeneration>this.timeToRegenerateShields&&(this.set("shields",this.shields+1),this.set("timeSinceShieldRegeneration",0)))}set(t,e){this[t]=e,this.emit(`${t}-updated`,e)}die(){this.dead||(this.dead=!0,this.emit("dead"))}canTakeDamage(){return this.timeSinceTakenDamage>=.2}takeDamage(t){this.canTakeDamage()&&(this.set("shields",this.shields-t),this.set("timeSinceTakenDamage",0),this.shields<0&&this.die())}}var c=i(2254),u=i(6065),y=i(1396);const g=i(3129);class m extends r{constructor(t){super(t.world),(0,d.Z)(this,"station",void 0),(0,d.Z)(this,"speed",100),this.station=t,this.width=10,this.height=5}get color(){return this.station.color}update(t){this.keepInBounds();let e=this.getNearestEnemy();if(e)if((0,u.Z)(e.x,e.y,this.x,this.y)<Math.max(this.width,e.width))this.collide(e),this.set("velocityX",-this.velocityX),this.set("velocityY",-this.velocityY);else{let t=this.getMoveTowardsForce(e),i=new g.Vector2(this.velocityX+4*t.x,this.velocityY+4*t.y);i.normalize(),this.set("velocityX",i.x*this.speed),this.set("velocityY",i.y*this.speed),this.set("angle",(0,c.Z)(this.velocityX,this.velocityY))}this.station.dead&&this.die(),super.update(t)}keepInBounds(){this.x<0?this.set("velocityX",Math.abs(this.velocityX)):this.x>this.world.bounds.width&&this.set("velocityX",-Math.abs(this.velocityX)),this.y<0?this.set("velocityY",Math.abs(this.velocityY)):this.y>this.world.bounds.height&&this.set("velocityY",-Math.abs(this.velocityY))}getNearestEnemy(){let t=this.world.getNearestEntity(this,(t=>t instanceof v?t!==this.station:t instanceof m&&t.station!==this.station));if(t)return t;{let t=this.world.entities.filter((t=>t instanceof v&&t!==this.station));return t.sort(((t,e)=>(0,y.Z)(t.x,t.y,this.x,this.y)-(0,y.Z)(e.x,e.y,this.x,this.y))),t[0]}}getMoveTowardsForce(t){let e=new g.Vector2(t.x-this.x,t.y-this.y);return e.normalize(),e}collide(t){if(!this.canTakeDamage()||!t.canTakeDamage())return;let e=1;t instanceof v&&(e=t.ships.length),this.takeDamage(1),t.takeDamage(1),t.dead&&this.station.set("money",this.station.money+e),this.dead&&(t instanceof v?t.set("money",t.money+1):t instanceof m&&t.station.set("money",t.station.money+1))}}class v extends r{constructor(t){super(t),(0,d.Z)(this,"color",16711680),(0,d.Z)(this,"ships",[]),(0,d.Z)(this,"money",0),this.key="station",this.width=20,this.height=20,this.shields=2,this.maxShields=2,this.timeToRegenerateShields=5}update(t){if(super.update(t),this.money>0){let t=new m(this);t.x=this.x,t.y=this.y,t.velocityX=(Math.random()>.5?-1:1)*Math.random()*t.speed,t.velocityY=(Math.random()>.5?-1:1)*Math.random()*t.speed,this.ships.push(t),t.on("dead",(()=>{let e=this.ships.indexOf(t);e>=0&&this.ships.splice(e,1)})),this.world.addEntity(t),this.set("money",this.money-1)}}die(){super.die(),this.ships.forEach((t=>{t.die()}))}}var p=i(7309),f=i(8973);class x extends l.EventEmitter{constructor(...t){super(...t),(0,d.Z)(this,"entities",[]),(0,d.Z)(this,"bounds",{width:0,height:0}),(0,d.Z)(this,"idCounter",0),(0,d.Z)(this,"quadtree",void 0)}load(t){t.entities.forEach((t=>{let e;switch(t.type){case"station":e=new v(this);break;default:e=new r(this);break}e.load(t),this.addEntity(e)})),t.bounds&&(this.bounds=t.bounds)}addEntity(t){this.entities.push(t),t.on("dead",(()=>{this.removeEntity(t)})),this.emit("entity-added",t)}removeEntity(t){let e=this.entities.indexOf(t);-1!==e&&this.entities.splice(e,1)}update(t){this.quadtree=new p.l({width:this.bounds.width,height:this.bounds.height}),this.entities.forEach((t=>{this.quadtree.insert(new f.A({x:t.x,y:t.y,width:t.width,height:t.height,data:{entity:t}}))})),this.entities.forEach((e=>{e.dead||e.update(t)}))}getNearestEntity(t,e){let i={x:t.x-50,y:t.y-50,width:t.width+100,height:t.height+100},s=this.getEntitiesInRange(i).filter((i=>i!==t&&!i.dead&&e(i)));return 0===s.length&&(i.x-=100,i.y-=100,i.width+=200,i.height+=200,s=this.getEntitiesInRange(i).filter((i=>i!==t&&e(i)))),s.sort(((e,i)=>(0,y.Z)(e.x,e.y,t.x,t.y)-(0,y.Z)(i.x,i.y,t.x,t.y))),s[0]??null}getEntitiesInRange(t){return this.quadtree.retrieve(new f.A(t)).map((t=>t.data.entity))}getId(){return this.idCounter++,this.idCounter}}var w=i(238);const b=t=>((0,s.dD)("data-v-12587e64"),t=t(),(0,s.Cn)(),t),Z={class:"home"},S={class:"list"},k=b((()=>(0,s._)("p",null,null,-1))),E=b((()=>(0,s._)("p",null,null,-1))),I=b((()=>(0,s._)("div",{id:"phaser-container-simple"},null,-1)));var j=(0,s.aZ)({setup(t){let e=new x;const i=(0,n.iH)(0),o=(0,n.iH)(0),d=(0,n.iH)(0),l=(0,n.iH)(0),r=(0,n.iH)(0),c=(0,n.iH)(0),u=(0,n.iH)([]);let y;function g(){let t=e.entities.filter((t=>t instanceof v));t.forEach((t=>{t.set("money",t.money+10)}))}return(0,s.bv)((()=>{let t=0,s=[];const h=window.innerWidth/3*2,n=window.innerHeight/3*2;let g=!1;y=new(a().Game)({type:a().AUTO,width:h,height:n,parent:"phaser-container-simple",scene:{preload(){this.load.image("boid","boid.png"),this.load.image("station","station.png"),this.load.image("shield","shield3.png")},create(){e.on("entity-added",(t=>{let e=this.add.image(t.x,t.y,t.key);e.setScale(t.width/e.width,t.height/e.height),e.shieldImage=this.add.image(t.x,t.y,"shield"),e.shieldImage.setScale(t.width/e.shieldImage.width*2,t.height/e.shieldImage.height*2),e.shieldImage.visible=t.shields>0,(t instanceof v||t instanceof m)&&e.setTint(t.color),["x","y","angle"].forEach((i=>{t.on(`${i}-updated`,(t=>{e[i]=t,e.shieldImage[i]=t}))})),t.on("dead",(()=>{e.destroy(),e.shieldImage.destroy()})),t.on("shields-updated",(t=>{e.shieldImage.visible=t>0}))}));let t=performance.now();e.load((0,w.Z)({stations:6,shipsPerStation:100,width:h,height:n}));let s=performance.now();i.value=s-t;let o=e.entities.filter((t=>t instanceof v));u.value=o.map((t=>{let e="#"+t.color.toString(16);return"#ffffff"===e&&(e="#00000"),{color:t.color,displayColor:e,ships:t.ships.length}})),this.input.keyboard.on("keydown-SPACE",(()=>{g=!g}))},update(i,h){if(g)return;let n=performance.now();e.update(h/1e3);let a=performance.now();if(s.push(a-n),t+=h,t>1e3){o.value=s.reduce(((t,e)=>Math.min(t,e)),1e6),d.value=s.reduce(((t,e)=>Math.max(t,e)),0),l.value=s.reduce(((t,e)=>t+e),0)/s.length,s=[],t=0,r.value=e.entities.filter((t=>t instanceof v)).length,c.value=e.entities.filter((t=>t instanceof m)).length;let i=e.entities.filter((t=>t instanceof v));u.value.forEach((t=>{let e=i.find((e=>e.color===t.color));e?t.ships=e.ships.length:t.ships>0&&(t.ships=0)}))}}}})})),(0,s.Jd)((()=>{y&&(y.destroy(),y=null)})),(t,e)=>((0,s.wg)(),(0,s.iD)("div",Z,[(0,s._)("div",S,[(0,s._)("div",null,"Startup time: "+(0,h.zw)(i.value.toFixed(2))+" ms",1),(0,s._)("div",null,"Update time: "+(0,h.zw)(o.value.toFixed(2))+" - "+(0,h.zw)(d.value.toFixed(2))+" ("+(0,h.zw)(l.value.toFixed(2))+" avg) ms",1),k,(0,s._)("div",null,"Entities: "+(0,h.zw)(r.value)+" stations and "+(0,h.zw)(c.value)+" ships",1),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)((0,n.SU)(u),(t=>((0,s.wg)(),(0,s.iD)("div",{key:t.color,style:(0,h.j5)({color:t.displayColor})},(0,h.zw)("#"+t.color.toString(16))+": "+(0,h.zw)(t.ships),5)))),128)),E,(0,s._)("button",{onClick:g},"Add Ships")]),I]))}}),D=i(89);const T=(0,D.Z)(j,[["__scopeId","data-v-12587e64"]]);var M=T}}]);
//# sourceMappingURL=simple.294c6f94.js.map