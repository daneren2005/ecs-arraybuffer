var Ve=Object.defineProperty;var Ge=(e,t,n)=>t in e?Ve(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var I=(e,t,n)=>(Ge(e,typeof t!="symbol"?t+"":t,n),n);import{P as xe,g as Xe}from"./generate-scene-oCWeBa7x.js";import{E as Ue}from"./index-CbRDAtpo.js";import{c as ee,R as ue,d as He,e as te,Q as Je,P as Qe}from"./quadtree.esm-D_1Ki0n2.js";import{d as Ke,r as D,o as Ze,a as et,c as V,b as F,t as U,F as Ee,e as Te,f as G,n as tt,p as nt,g as ot,_ as st}from"./index-BLx1M3Ps.js";var W={i8:"i8",ui8:"ui8",ui8c:"ui8c",i16:"i16",ui16:"ui16",i32:"i32",ui32:"ui32",f32:"f32",f64:"f64",eid:"eid"},Ce={i8:"Int8",ui8:"Uint8",ui8c:"Uint8Clamped",i16:"Int16",ui16:"Uint16",i32:"Int32",ui32:"Uint32",eid:"Uint32",f32:"Float32",f64:"Float64"},N={i8:Int8Array,ui8:Uint8Array,ui8c:Uint8ClampedArray,i16:Int16Array,ui16:Uint16Array,i32:Int32Array,ui32:Uint32Array,f32:Float32Array,f64:Float64Array,eid:Uint32Array},Me={uint8:2**8,uint16:2**16,uint32:2**32},it=e=>t=>Math.ceil(t/e)*e,rt=it(4),at=Symbol("storeRef"),ce=Symbol("storeSize"),ct=Symbol("storeMaps"),z=Symbol("storeFlattened"),ne=Symbol("storeBase"),lt=Symbol("storeType"),Be=Symbol("storeArrayElementCounts"),oe=Symbol("storeSubarrays"),Oe=Symbol("subarrayCursors"),ht=Symbol("subarray"),le=Symbol("parentArray"),je=Symbol("tagStore"),Re=Symbol("indexType"),ke=Symbol("indexBytes"),Pe=Symbol("isEidType"),Q={},mt=(e,t)=>{if(ArrayBuffer.isView(e))e[t]=e.slice(0);else{const n=e[le].slice(0);e[t]=e.map((i,r)=>{const{length:a}=e[r],o=a*r,s=o+a;return n.subarray(o,s)})}},dt=(e,t)=>{e[z]&&e[z].forEach(n=>{ArrayBuffer.isView(n)?n[t]=0:n[t].fill(0)})},ut=(e,t)=>{const n=t*N[e].BYTES_PER_ELEMENT,i=new ArrayBuffer(n),r=new N[e](i);return r[Pe]=e===W.eid,r},yt=(e,t,n)=>{const i=e[ce],r=Array(i).fill(0);r[lt]=t,r[Pe]=t===W.eid;const a=e[Oe],o=n<=Me.uint8?W.ui8:n<=Me.uint16?W.ui16:W.ui32;if(!n)throw new Error("bitECS - Must define component array length");if(!N[t])throw new Error(`bitECS - Invalid component array property type ${t}`);if(!e[oe][t]){const l=e[Be][t],d=new N[t](rt(l*i));d[Re]=Ce[o],d[ke]=N[o].BYTES_PER_ELEMENT,e[oe][t]=d}const s=a[t],c=s+i*n;a[t]=c,r[le]=e[oe][t].subarray(s,c);for(let l=0;l<i;l++){const d=n*l,g=d+n;r[l]=r[le].subarray(d,g),r[l][Re]=Ce[o],r[l][ke]=N[o].BYTES_PER_ELEMENT,r[l][ht]=!0}return r},Ae=e=>Array.isArray(e)&&typeof e[0]=="string"&&typeof e[1]=="number",pt=(e,t)=>{const n=Symbol("store");if(!e||!Object.keys(e).length)return Q[n]={[ce]:t,[je]:!0,[ne]:()=>Q[n]},Q[n];e=JSON.parse(JSON.stringify(e));const i={},r=o=>{const s=Object.keys(o);for(const c of s)Ae(o[c])?(i[o[c][0]]||(i[o[c][0]]=0),i[o[c][0]]+=o[c][1]):o[c]instanceof Object&&r(o[c])};r(e);const a={[ce]:t,[ct]:{},[oe]:{},[at]:n,[Oe]:Object.keys(N).reduce((o,s)=>({...o,[s]:0}),{}),[z]:[],[Be]:i};if(e instanceof Object&&Object.keys(e).length){const o=(s,c)=>{if(typeof s[c]=="string")s[c]=ut(s[c],t),s[c][ne]=()=>Q[n],a[z].push(s[c]);else if(Ae(s[c])){const[l,d]=s[c];s[c]=yt(a,l,d),s[c][ne]=()=>Q[n],a[z].push(s[c])}else s[c]instanceof Object&&(s[c]=Object.keys(s[c]).reduce(o,s[c]));return s};return Q[n]=Object.assign(Object.keys(e).reduce(o,e),a),Q[n][ne]=()=>Q[n],Q[n]}},X=()=>{const e=[],t=[];e.sort=function(o){const s=Array.prototype.sort.call(this,o);for(let c=0;c<e.length;c++)t[e[c]]=c;return s};const n=o=>e[t[o]]===o;return{add:o=>{n(o)||(t[o]=e.push(o)-1)},remove:o=>{if(!n(o))return;const s=t[o],c=e.pop();c!==o&&(e[s]=c,t[c]=s)},has:n,sparse:t,dense:e,reset:()=>{e.length=0,t.length=0}}},j=Symbol("entityMasks"),re=Symbol("entityComponents"),Y=Symbol("entitySparseSet"),J=Symbol("entityArray"),ft=1e5,he=0,De=ft,ye=()=>De,H=[],gt=.01,St=gt,vt=()=>he,bt=new Map,xt=e=>{const t=e[ve]?H.length?H.shift():he++:H.length>Math.round(De*St)?H.shift():he++;if(t>e[Se])throw new Error("bitECS - max entities reached");return e[Y].add(t),bt.set(t,e),e[pe].forEach(n=>{fe(e,n,t)&&ge(n,t)}),e[re].set(t,new Set),t},Fe=(e,t)=>{if(e[Y].has(t)){e[ae].forEach(n=>{Ye(e,n,t)}),e[ve]||H.push(t),e[Y].remove(t),e[re].delete(t),e[Le].delete(e[de].get(t)),e[de].delete(t);for(let n=0;n<e[j].length;n++)e[j][n][t]=0}},Ne=Symbol("$modifier");function Et(e,t){const n=()=>[e,t];return n[Ne]=!0,n}var $e=e=>Et(e,"changed"),ae=Symbol("queries"),pe=Symbol("notQueries"),Tt=Symbol("queryAny"),Ct=Symbol("queryAll"),Mt=Symbol("queryNone"),ie=Symbol("queryMap"),K=Symbol("$dirtyQueries"),ze=Symbol("queryComponents"),Rt=(e,t)=>{const n=[],i=[],r=[];t[ze].forEach(h=>{if(typeof h=="function"&&h[Ne]){const[m,y]=h();e[B].has(m)||me(e,m),y==="not"&&i.push(m),y==="changed"&&(r.push(m),n.push(m))}else e[B].has(h)||me(e,h),n.push(h)});const a=h=>e[B].get(h),o=n.concat(i).map(a),s=X(),c=[],l=[],d=X(),g=X(),C=X(),b=o.map(h=>h.generationId).reduce((h,m)=>(h.includes(m)||h.push(m),h),[]),f=(h,m)=>(h[m.generationId]||(h[m.generationId]=0),h[m.generationId]|=m.bitflag,h),E=n.map(a).reduce(f,{}),u=i.map(a).reduce(f,{}),M=o.reduce(f,{}),p=n.filter(h=>!h[je]).map(h=>Object.getOwnPropertySymbols(h).includes(z)?h[z]:[h]).reduce((h,m)=>h.concat(m),[]),S=Object.assign(s,{archetypes:c,changed:l,components:n,notComponents:i,changedComponents:r,allComponents:o,masks:E,notMasks:u,hasMasks:M,generations:b,flatProps:p,toRemove:d,entered:g,exited:C,shadows:[]});e[ie].set(t,S),e[ae].add(S),o.forEach(h=>{h.queries.add(S)}),i.length&&e[pe].add(S);for(let h=0;h<vt();h++){if(!e[Y].has(h))continue;fe(e,S,h)&&ge(S,h)}},kt=(e,t)=>{const n=Symbol(),i=e.flatProps[t];return mt(i,n),e.shadows[t]=i[n],i[n]},At=(e,t)=>{t&&(e.changed=[]);const{flatProps:n,shadows:i}=e;for(let r=0;r<e.dense.length;r++){const a=e.dense[r];let o=!1;for(let s=0;s<n.length;s++){const c=n[s],l=i[s]||kt(e,s);if(ArrayBuffer.isView(c[a])){for(let d=0;d<c[a].length;d++)if(c[a][d]!==l[a][d]){o=!0;break}l[a].set(c[a])}else c[a]!==l[a]&&(o=!0,l[a]=c[a])}o&&e.changed.push(a)}return e.changed},A=(...e)=>{let t,n,i,r;if(Array.isArray(e[0])&&(t=e[0]),t===void 0||t[B]!==void 0)return o=>o?o[J]:t[J];const a=function(o,s=!0){o[ie].has(a)||Rt(o,a);const c=o[ie].get(a);return It(o),c.changedComponents.length?At(c,s):c.dense};return a[ze]=t,a[Tt]=n,a[Ct]=i,a[Mt]=r,a},fe=(e,t,n)=>{const{masks:i,notMasks:r,generations:a}=t;for(let o=0;o<a.length;o++){const s=a[o],c=i[s],l=r[s],d=e[j][s][n];if(l&&d&l||c&&(d&c)!==c)return!1}return!0},ge=(e,t)=>{e.toRemove.remove(t),e.entered.add(t),e.add(t)},$t=e=>{for(let t=e.toRemove.dense.length-1;t>=0;t--){const n=e.toRemove.dense[t];e.toRemove.remove(n),e.remove(n)}},It=e=>{e[K].size&&(e[K].forEach($t),e[K].clear())},Ye=(e,t,n)=>{!t.has(n)||t.toRemove.has(n)||(t.toRemove.add(n),e[K].add(t),t.exited.add(n))},B=Symbol("componentMap"),L=(e,t)=>{const n=pt(e,t||ye());return e&&Object.keys(e).length,n},_t=e=>{e[Z]*=2,e[Z]>=2**31&&(e[Z]=1,e[j].push(new Uint32Array(e[Se])))},me=(e,t)=>{if(!t)throw new Error("bitECS - Cannot register null or undefined component");const n=new Set,i=new Set,r=new Set;e[ae].forEach(a=>{a.allComponents.includes(t)&&n.add(a)}),e[B].set(t,{generationId:e[j].length-1,bitflag:e[Z],store:t,queries:n,notQueries:i,changedQueries:r}),_t(e)},O=(e,t,n)=>{const i=e[B].get(t);if(!i)return!1;const{generationId:r,bitflag:a}=i;return(e[j][r][n]&a)===a},wt=(e,t,n,i=!1)=>{if(n===void 0)throw new Error("bitECS - entity is undefined.");if(!e[Y].has(n))throw new Error("bitECS - entity does not exist in the world.");if(e[B].has(t)||me(e,t),O(e,t,n))return;const r=e[B].get(t),{generationId:a,bitflag:o,queries:s,notQueries:c}=r;e[j][a][n]|=o,s.forEach(l=>{l.toRemove.remove(n);const d=fe(e,l,n);d&&(l.exited.remove(n),ge(l,n)),d||(l.entered.remove(n),Ye(e,l,n))}),e[re].get(n).add(t),i&&dt(t,n)},Se=Symbol("size"),Z=Symbol("bitflag"),Ut=Symbol("archetypes"),Le=Symbol("localEntities"),de=Symbol("localEntityLookup"),ve=Symbol("manualEntityRecycling"),Qt=(...e)=>{const t=typeof e[0]=="object"?e[0]:{},n=typeof e[0]=="number"?e[0]:typeof e[1]=="number"?e[1]:ye();return Bt(t,n),t},Bt=(e,t=ye())=>(e[Se]=t,e[J]&&e[J].forEach(n=>Fe(e,n)),e[j]=[new Uint32Array(t)],e[re]=new Map,e[Ut]=[],e[Y]=X(),e[J]=e[Y].dense,e[Z]=1,e[B]=new Map,e[ie]=new Map,e[ae]=new Set,e[pe]=new Set,e[K]=new Set,e[Le]=new Map,e[de]=new Map,e[ve]=!1,e),x=W;class be extends Ue{constructor(n){super();I(this,"world");I(this,"eid");I(this,"type","entity");I(this,"key","boid");this.eid=xt(n.ecs),this.world=n,this.addComponent(n.components.position),this.addComponent(n.components.health),this.shields=1,this.maxShields=1,this.timeToRegenerateShields=1,this.timeSinceShieldRegeneration=0,this.timeSinceTakenDamage=0,this.dead=0}get x(){return this.world.components.position.x[this.eid]}set x(n){this.world.components.position.x[this.eid]=n}get y(){return this.world.components.position.y[this.eid]}set y(n){this.world.components.position.y[this.eid]=n}get width(){return this.world.components.position.width[this.eid]}set width(n){this.world.components.position.width[this.eid]=n}get height(){return this.world.components.position.height[this.eid]}set height(n){this.world.components.position.height[this.eid]=n}get shields(){return this.world.components.health.shields[this.eid]}set shields(n){this.world.components.health.shields[this.eid]=n}get maxShields(){return this.world.components.health.maxShields[this.eid]}set maxShields(n){this.world.components.health.maxShields[this.eid]=n}get timeToRegenerateShields(){return this.world.components.health.timeToRegenerateShields[this.eid]}set timeToRegenerateShields(n){this.world.components.health.timeToRegenerateShields[this.eid]=n}get timeSinceShieldRegeneration(){return this.world.components.health.timeSinceShieldRegeneration[this.eid]}set timeSinceShieldRegeneration(n){this.world.components.health.timeSinceShieldRegeneration[this.eid]=n}get timeSinceTakenDamage(){return this.world.components.health.timeSinceTakenDamage[this.eid]}set timeSinceTakenDamage(n){this.world.components.health.timeSinceTakenDamage[this.eid]=n}get dead(){return this.world.components.health.shields[this.eid]}set dead(n){this.world.components.health.shields[this.eid]=n}load(n){Object.keys(n).forEach(i=>{this[i]=n[i]})}set(n,i,r){this.world.components[n][i][this.eid]=r}addComponent(n){wt(this.world.ecs,n,this.eid)}}class se extends be{get color(){return this.world.components.controller.color[this.eid]}set color(t){this.world.components.controller.color[this.eid]=t}get money(){return this.world.components.controller.money[this.eid]}set money(t){this.world.components.controller.money[this.eid]=t}constructor(t){super(t),this.addComponent(t.components.controller),this.key="station",this.width=20,this.height=20,this.shields=2,this.maxShields=2,this.timeToRegenerateShields=5}}class We extends be{get color(){return this.world.components.controller.color[this.world.components.controlled.owner[this.eid]]}get velocityX(){return this.world.components.velocity.x[this.eid]}set velocityX(t){this.world.components.velocity.x[this.eid]=t}get velocityY(){return this.world.components.velocity.y[this.eid]}set velocityY(t){this.world.components.velocity.y[this.eid]=t}get station(){return this.world.getEntity(this.eid)}constructor(t){super(t.world);let n=t.world;this.addComponent(n.components.velocity),this.addComponent(n.components.controlled),this.addComponent(n.components.attack),this.width=10,this.height=5,this.shields=1,this.maxShields=1,this.timeToRegenerateShields=1,this.world.components.velocity.speed[this.eid]=100,n.components.controlled.owner[this.eid]=t.eid}}function Ot(e){const t=e.components.controller,n=e.components.health;let i=A([t]);return r=>(i(r).filter(o=>!n.dead[o]).forEach(o=>{let s=e.getEntity(o);if(t.money[o]>0){let c=new We(s);c.x=s.x,c.y=s.y,c.velocityX=(Math.random()>.5?-1:1)*Math.random()*e.components.velocity.speed[c.eid],c.velocityY=(Math.random()>.5?-1:1)*Math.random()*e.components.velocity.speed[c.eid],e.components.position.angle[c.eid]=ee(c.velocityX,c.velocityY),e.addEntity(c),t.money[o]--}}),r)}const jt={x:x.f32,y:x.f32,width:x.f32,height:x.f32,angle:x.f32},Pt={color:x.f32,money:x.i32},Dt={x:x.f32,y:x.f32,speed:x.f32},Ft={shields:x.i32,maxShields:x.i32,timeToRegenerateShields:x.f32,timeSinceShieldRegeneration:x.f32,timeSinceTakenDamage:x.f32,dead:x.ui8},Nt={owner:x.eid},zt={target:x.eid},k={position:L(jt),controller:L(Pt),velocity:L(Dt),health:L(Ft),controlled:L(Nt),attack:L(zt)};function Yt(e){const t=e.components.position,n=e.components.velocity;let i=A([t,n]);return(r,a)=>(i(r).forEach(s=>{t.x[s]+=n.x[s]*a,t.y[s]+=n.y[s]*a,(t.x[s]<0||t.x[s]>e.bounds.width)&&(n.x[s]=-n.x[s],t.angle[s]=ee(n.x[s],n.y[s])),(t.y[s]<0||t.y[s]>e.bounds.height)&&(n.y[s]=-n.y[s],t.angle[s]=ee(n.x[s],n.y[s]))}),r)}function Lt(e){const t=e.components.position,n=e.components.velocity,i=e.components.controlled,r=e.components.controller,a=e.components.health;let o=A([n]);const s=.03;let c=s+1,l=[],d=0;return(g,C)=>{c+=C,c>s&&l.length===0&&(l=o(g).filter(E=>!a.dead[E]),d=l.length/2,c=0);let b=g.quadtree,f=performance.now();for(let E=0;E<l.length;E++){let u=l[E],M=b.retrieve(new ue({x:t.x[u],y:t.y[u],width:t.width[u],height:t.height[u]})).map(h=>h.data.eid).filter(h=>h!==u),p=r.color[i.owner[u]],S=M.filter(h=>{if(O(g,i,h)){let m=i.owner[h];return r.color[m]!==p}else return O(g,r,h)?r.color[h]!==p:!1}).filter(h=>He(t.x[h],t.y[h],t.x[u],t.y[u])<Math.max(t.width[u],t.width[h]));if(S.length&&(Wt(e,l,u,S[0]),n.x[u]=-n.x[u],n.y[u]=-n.y[u],t.angle[u]=ee(n.x[u],n.y[u])),E%10===0&&E>d&&performance.now()-f>C*1e3/2)return l=l.slice(E),g}return l=[],g}}function Wt(e,t,n,i){if(!_e(e,n)||!_e(e,i))return;let r=1;O(e.ecs,e.components.controller,i)&&(r=t.filter(o=>e.components.controlled.owner[o]===i).length),Ie(e,t,n,1),Ie(e,t,i,1);const a=e.components.controlled;if(e.components.health.dead[i]){let o=a.owner[n];e.components.controller.money[o]+=r}if(e.components.health.dead[n])if(O(e.ecs,a,i)){let o=a.owner[i];e.components.controller.money[o]+=1}else O(e.ecs,e.components.controller,i)&&(e.components.controller.money[i]+=1)}function Ie(e,t,n,i){const r=e.components.health;r.shields[n]-=i,r.timeSinceTakenDamage[n]=0,r.shields[n]<0&&(r.dead[n]=1,O(e.ecs,e.components.controller,n)&&t.filter(o=>e.components.controlled.owner[o]===n).forEach(o=>{r.dead[o]=1}))}function _e(e,t){return e.components.health.timeSinceTakenDamage[t]>=.2}function qt(e){const t=e.components.position,n=e.components.velocity,i=e.components.controlled,r=e.components.controller,a=e.components.health,o=e.components.attack;let s=A([n,o]),c=A([r]);const l=.2;let d=l+1,g=[],C=0;return(b,f)=>{d+=f,d>l&&g.length===0&&(g=s(b).filter(M=>!a.dead[M]),C=g.length/(l/f),d=0);let E=b.quadtree,u=performance.now();for(let M=0;M<g.length;M++){let p=g[M],P=r.color[i.owner[p]],S={x:t.x[p]-50,y:t.y[p]-50,width:t.width[p]+100,height:t.height[p]+100},h=we(E,b,S,p,P,e);h.length===0&&(S.x-=100,S.y-=100,S.width+=200,S.height+=200,h=we(E,b,S,p,P,e)),h.sort((y,_)=>te(t.x[y],t.y[y],t.x[p],t.y[p])-te(t.x[_],t.y[_],t.x[p],t.y[p]));let m=h[0]??0;if(!m){let y=c(b).filter(_=>r.color[_]!==P&&!a.dead[_]);y.sort((_,R)=>te(t.x[_],t.y[_],t.x[p],t.y[p])-te(t.x[R],t.y[R],t.x[p],t.y[p])),m=y[0]??0}if(o.target[p]=m,M%10===0&&M>C&&performance.now()-u>f*1e3/2)return g=g.slice(M),b}return g=[],b}}function we(e,t,n,i,r,a){const o=a.components.controlled,s=a.components.controller;return e.retrieve(new ue(n)).map(l=>l.data.eid).filter(l=>l!==i).filter(l=>{if(O(t,o,l)){let d=o.owner[l];return s.color[d]!==r}else return O(t,s,l)?s.color[l]!==r:!1})}function Vt(e){const t=e.components.position,n=e.components.health;let i=A([t,n]);return r=>{let a=new Je({width:e.bounds.width,height:e.bounds.height});return i(r).forEach(o=>{n.dead[o]||a.insert(new ue({x:t.x[o],y:t.y[o],width:t.width[o],height:t.height[o],data:{eid:o}}))}),r.quadtree=a,r}}function Gt(e){const t=e.components.health;let n=A([t]);return(i,r)=>(n(i).forEach(a=>{t.timeSinceTakenDamage[a]+=r,t.shields[a]<t.maxShields[a]&&(t.timeSinceShieldRegeneration[a]+=r,t.timeSinceShieldRegeneration[a]>t.timeToRegenerateShields[a]&&(t.shields[a]++,t.timeSinceShieldRegeneration[a]=0))}),i)}function Xt(e){const t=e.components.position,n=e.components.velocity,i=e.components.attack,r=e.components.health;let a=A([n,i]);return o=>(a(o).forEach(s=>{let c=i.target[s];if(!c||r.dead[c])return;let l=Ht(t,s,c),d=new Qe.Vector2(n.x[s]+l.x*4,n.y[s]+l.y*4);d.normalize(),n.x[s]=d.x*n.speed[s],n.y[s]=d.y*n.speed[s],t.angle[s]=ee(n.x[s],n.y[s])}),o)}function Ht(e,t,n){let i=new Qe.Vector2(e.x[n]-e.x[t],e.y[n]-e.y[t]);return i.normalize(),i}class Jt extends Ue{constructor(){super();I(this,"ecs");I(this,"eidMap",new Map);I(this,"bounds",{width:0,height:0});I(this,"components",k);I(this,"systems",[]);I(this,"systemUpdates",{});this.ecs=Qt(),this.addSystem("quadTreeSystem",Vt(this)),this.addSystem("spawnShipSystem",Ot(this)),this.addSystem("targetEnemySystem",qt(this)),this.addSystem("moveToTargetSystem",Xt(this)),this.addSystem("velocitySystem",Yt(this)),this.addSystem("collisionSystem",Lt(this)),this.addSystem("updateHealthTimersSystem",Gt(this))}get entities(){return[...this.eidMap.values()]}load(n){n.entities.forEach(i=>{let r;switch(i.type){case"station":r=new se(this);break;default:r=new be(this);break}r.load(i),this.addEntity(r)}),n.bounds&&(this.bounds=n.bounds)}addEntity(n){this.emit("entity-added",n),this.eidMap.set(n.eid,n)}removeEntity(n){Fe(this.ecs,n),this.eidMap.delete(n)}getEntity(n){return this.eidMap.get(n)??null}update(n){this.systems.forEach(i=>{i(this.ecs,n)})}addSystem(n,i){this.systems.push((r,a)=>{let o=performance.now();return i(r,a),this.systemUpdates[n].push(performance.now()-o),r}),this.systemUpdates[n]=[]}}const qe=e=>(nt("data-v-5aa168ca"),e=e(),ot(),e),Kt={class:"home"},Zt={class:"list"},en={style:{color:"red"}},tn=qe(()=>F("p",null,null,-1)),nn=qe(()=>F("div",{id:"phaser-container-bitecs"},null,-1)),on=Ke({__name:"BitECSGame",setup(e){let t=new Jt;const n=D(0),i=D(0),r=D(0),a=D(0),o=D(0),s=D([]),c=A([k.controller]),l=D([]);let d;Ze(()=>{let C=0,b=[];const f=window.innerWidth/3*2,E=window.innerHeight/3*2;let u=!1;const M=A([$e(k.position)]),p=A([$e(k.health)]),P=A([k.controlled]),S=new Map;d=new xe.Game({type:xe.AUTO,width:f,height:E,parent:"phaser-container-bitecs",scene:{preload(){this.load.image("boid","boid.png"),this.load.image("station","station.png"),this.load.image("shield","shield3.png")},create(){t.on("entity-added",m=>{let y=this.add.image(m.x,m.y,m.key);y.setScale(m.width/y.width,m.height/y.height),y.shieldImage=this.add.image(m.x,m.y,"shield"),y.shieldImage.setScale(m.width/y.shieldImage.width*2,m.height/y.shieldImage.height*2),y.shieldImage.visible=m.shields>0,(m instanceof se||m instanceof We)&&y.setTint(m.color),S.set(m.eid,y)}),t.load(Xe({stations:6,shipsPerStation:100,width:f,height:E}));let h=t.entities.filter(m=>m instanceof se);s.value=h.map(m=>{let y="#"+m.color.toString(16);return y==="#ffffff"&&(y="#00000"),{eid:m.eid,color:m.color,displayColor:y,ships:0}}),this.input.keyboard.on("keydown-SPACE",()=>{u=!u}),Object.keys(t.systemUpdates).forEach(m=>{l.value.push({name:m,min:0,avg:0,max:0})})},update(h,m){if(u)return;let y=performance.now();t.update(m/1e3),M(t.ecs).forEach(R=>{let T=S.get(R);T&&(T.x=T.shieldImage.x=k.position.x[R],T.y=T.shieldImage.y=k.position.y[R],T.angle=T.shieldImage.angle=k.position.angle[R])}),p(t.ecs).forEach(R=>{let T=S.get(R);T&&(T.shieldImage.visible=k.health.shields[R]>0,k.health.dead[R]&&(T.destroy(),T.shieldImage.destroy(),S.delete(R)))});let _=performance.now();if(b.push(_-y),C+=m,C>1e3){n.value=b.reduce((v,$)=>Math.min(v,$),1e6),i.value=b.reduce((v,$)=>Math.max(v,$),0),r.value=b.reduce((v,$)=>v+$,0)/b.length,b=[],C=0,a.value=t.entities.filter(v=>v instanceof se).length;let R=c(t.ecs).filter(v=>!k.health.dead[v]),T=P(t.ecs).filter(v=>!k.health.dead[v]);o.value=T.length,s.value.forEach(v=>{R.find(w=>k.controller.color[w]===v.color)!==void 0?v.ships=T.filter(w=>k.controlled.owner[w]===v.eid).length:v.ships>0&&(v.ships=0)}),l.value=[],Object.keys(t.systemUpdates).forEach(v=>{let $=t.systemUpdates[v];l.value.push({name:v,min:$.reduce((w,q)=>Math.min(w,q),1e6),avg:$.reduce((w,q)=>w+q,0)/$.length,max:$.reduce((w,q)=>Math.max(w,q),0)}),t.systemUpdates[v]=[]})}}}})}),et(()=>{d&&(d.destroy(),d=null)});function g(){c(t.ecs).forEach(C=>{t.components.controller.money[C]+=10})}return(C,b)=>(G(),V("div",Kt,[F("div",Zt,[F("div",en,"mainThread: "+U(i.value.toFixed(2))+" ("+U(r.value.toFixed(2))+" avg) ms",1),(G(!0),V(Ee,null,Te(l.value,f=>(G(),V("div",{key:f.name},U(f.name)+": "+U(f.max.toFixed(2))+" ("+U(f.avg.toFixed(2))+" avg) ms",1))),128)),tn,F("div",null,"Entities: "+U(a.value)+" stations and "+U(o.value)+" ships",1),(G(!0),V(Ee,null,Te(s.value,f=>(G(),V("span",{class:"station-list",key:f.color,style:tt({color:f.displayColor})},U("#"+f.color.toString(16))+": "+U(f.ships),5))),128)),F("div",null,[F("button",{onClick:g},"Add Ships")])]),nn]))}}),hn=st(on,[["__scopeId","data-v-5aa168ca"]]);export{hn as default};
