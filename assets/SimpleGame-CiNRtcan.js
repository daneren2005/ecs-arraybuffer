var q=Object.defineProperty;var A=(l,n,e)=>n in l?q(l,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[n]=e;var i=(l,n,e)=>(A(l,typeof n!="symbol"?n+"":n,e),e);import{P as C,g as O}from"./generate-scene-oCWeBa7x.js";import{E as P}from"./index-CbRDAtpo.js";import{d as z,P as F,c as G,e as E,Q as V,R as B}from"./quadtree.esm-D_1Ki0n2.js";import{d as W,r as y,o as Q,a as $,c as I,b as f,t as p,F as j,e as H,f as M,n as L,p as J,g as K,_ as Z}from"./index-BLx1M3Ps.js";class D extends P{constructor(e){super();i(this,"world");i(this,"id");i(this,"x",0);i(this,"y",0);i(this,"width",0);i(this,"height",0);i(this,"angle",0);i(this,"velocityX",0);i(this,"velocityY",0);i(this,"type","entity");i(this,"key","boid");i(this,"shields",1);i(this,"maxShields",1);i(this,"timeToRegenerateShields",1);i(this,"timeSinceShieldRegeneration",0);i(this,"timeSinceTakenDamage",0);i(this,"dead",!1);this.world=e,this.id=e.getId()}load(e){Object.keys(e).forEach(t=>{this[t]=e[t]})}update(e){this.set("x",this.x+this.velocityX*e),this.set("y",this.y+this.velocityY*e),this.set("timeSinceTakenDamage",this.timeSinceTakenDamage+e),this.shields<this.maxShields&&(this.set("timeSinceShieldRegeneration",this.timeSinceShieldRegeneration+e),this.timeSinceShieldRegeneration>this.timeToRegenerateShields&&(this.set("shields",this.shields+1),this.set("timeSinceShieldRegeneration",0)))}set(e,t){this[e]=t,this.emit(`${e}-updated`,t)}die(){this.dead||(this.dead=!0,this.emit("dead"))}canTakeDamage(){return this.timeSinceTakenDamage>=.2}takeDamage(e){this.canTakeDamage()&&(this.set("shields",this.shields-e),this.set("timeSinceTakenDamage",0),this.shields<0&&this.die())}}class v extends D{constructor(e){super(e.world);i(this,"station");i(this,"speed",100);this.station=e,this.width=10,this.height=5}get color(){return this.station.color}update(e){this.keepInBounds();let t=this.getNearestEnemy();if(t)if(z(t.x,t.y,this.x,this.y)<Math.max(this.width,t.width))this.collide(t),this.set("velocityX",-this.velocityX),this.set("velocityY",-this.velocityY);else{let s=this.getMoveTowardsForce(t),d=new F.Vector2(this.velocityX+s.x*4,this.velocityY+s.y*4);d.normalize(),this.set("velocityX",d.x*this.speed),this.set("velocityY",d.y*this.speed),this.set("angle",G(this.velocityX,this.velocityY))}this.station.dead&&this.die(),super.update(e)}keepInBounds(){this.x<0?this.set("velocityX",Math.abs(this.velocityX)):this.x>this.world.bounds.width&&this.set("velocityX",-Math.abs(this.velocityX)),this.y<0?this.set("velocityY",Math.abs(this.velocityY)):this.y>this.world.bounds.height&&this.set("velocityY",-Math.abs(this.velocityY))}getNearestEnemy(){let e=this.world.getNearestEntity(this,t=>t instanceof u?t!==this.station:t instanceof v?t.station!==this.station:!1);if(e)return e;{let t=this.world.entities.filter(s=>s instanceof u&&s!==this.station);return t.sort((s,d)=>E(s.x,s.y,this.x,this.y)-E(d.x,d.y,this.x,this.y)),t[0]}}getMoveTowardsForce(e){let t=new F.Vector2(e.x-this.x,e.y-this.y);return t.normalize(),t}collide(e){if(!this.canTakeDamage()||!e.canTakeDamage())return;let t=1;e instanceof u&&(t=e.ships.length),this.takeDamage(1),e.takeDamage(1),e.dead&&this.station.set("money",this.station.money+t),this.dead&&(e instanceof u?e.set("money",e.money+1):e instanceof v&&e.station.set("money",e.station.money+1))}}class u extends D{constructor(e){super(e);i(this,"color",16711680);i(this,"ships",[]);i(this,"money",0);this.key="station",this.width=20,this.height=20,this.shields=2,this.maxShields=2,this.timeToRegenerateShields=5}update(e){if(super.update(e),this.money>0){let t=new v(this);t.x=this.x,t.y=this.y,t.velocityX=(Math.random()>.5?-1:1)*Math.random()*t.speed,t.velocityY=(Math.random()>.5?-1:1)*Math.random()*t.speed,this.ships.push(t),t.on("dead",()=>{let s=this.ships.indexOf(t);s>=0&&this.ships.splice(s,1)}),this.world.addEntity(t),this.set("money",this.money-1)}}die(){super.die(),this.ships.forEach(e=>{e.die()})}}class ee extends P{constructor(){super(...arguments);i(this,"entities",[]);i(this,"bounds",{width:0,height:0});i(this,"idCounter",0);i(this,"quadtree")}load(e){e.entities.forEach(t=>{let s;switch(t.type){case"station":s=new u(this);break;default:s=new D(this);break}s.load(t),this.addEntity(s)}),e.bounds&&(this.bounds=e.bounds)}addEntity(e){this.entities.push(e),e.on("dead",()=>{this.removeEntity(e)}),this.emit("entity-added",e)}removeEntity(e){let t=this.entities.indexOf(e);t!==-1&&this.entities.splice(t,1)}update(e){this.quadtree=new V({width:this.bounds.width,height:this.bounds.height}),this.entities.forEach(t=>{this.quadtree.insert(new B({x:t.x,y:t.y,width:t.width,height:t.height,data:{entity:t}}))}),this.entities.forEach(t=>{t.dead||t.update(e)})}getNearestEntity(e,t){let s={x:e.x-50,y:e.y-50,width:e.width+100,height:e.height+100},d=this.getEntitiesInRange(s).filter(r=>r!==e&&!r.dead&&t(r));return d.length===0&&(s.x-=100,s.y-=100,s.width+=200,s.height+=200,d=this.getEntitiesInRange(s).filter(r=>r!==e&&t(r))),d.sort((r,w)=>E(r.x,r.y,e.x,e.y)-E(w.x,w.y,e.x,e.y)),d[0]??null}getEntitiesInRange(e){return this.quadtree.retrieve(new B(e)).map(t=>t.data.entity)}getId(){return this.idCounter++,this.idCounter}}const R=l=>(J("data-v-36261972"),l=l(),K(),l),te={class:"home"},ie={class:"list"},se=R(()=>f("p",null,null,-1)),ae=R(()=>f("p",null,null,-1)),he=R(()=>f("div",{id:"phaser-container-simple"},null,-1)),ne=W({__name:"SimpleGame",setup(l){let n=new ee;const e=y(0),t=y(0),s=y(0),d=y(0),r=y(0),w=y(0),T=y([]);let S;Q(()=>{let x=0,c=[];const g=window.innerWidth/3*2,X=window.innerHeight/3*2;let _=!1;S=new C.Game({type:C.AUTO,width:g,height:X,parent:"phaser-container-simple",scene:{preload(){this.load.image("boid","boid.png"),this.load.image("station","station.png"),this.load.image("shield","shield3.png")},create(){n.on("entity-added",a=>{let o=this.add.image(a.x,a.y,a.key);o.setScale(a.width/o.width,a.height/o.height),o.shieldImage=this.add.image(a.x,a.y,"shield"),o.shieldImage.setScale(a.width/o.shieldImage.width*2,a.height/o.shieldImage.height*2),o.shieldImage.visible=a.shields>0,(a instanceof u||a instanceof v)&&o.setTint(a.color),["x","y","angle"].forEach(h=>{a.on(`${h}-updated`,m=>{o[h]=m,o.shieldImage[h]=m})}),a.on("dead",()=>{o.destroy(),o.shieldImage.destroy()}),a.on("shields-updated",h=>{o.shieldImage.visible=h>0})});let Y=performance.now();n.load(O({stations:6,shipsPerStation:100,width:g,height:X}));let k=performance.now();e.value=k-Y;let b=n.entities.filter(a=>a instanceof u);T.value=b.map(a=>{let o="#"+a.color.toString(16);return o==="#ffffff"&&(o="#00000"),{color:a.color,displayColor:o,ships:a.ships.length}}),this.input.keyboard.on("keydown-SPACE",()=>{_=!_})},update(Y,k){if(_)return;let b=performance.now();n.update(k/1e3);let a=performance.now();if(c.push(a-b),x+=k,x>1e3){t.value=c.reduce((h,m)=>Math.min(h,m),1e6),s.value=c.reduce((h,m)=>Math.max(h,m),0),d.value=c.reduce((h,m)=>h+m,0)/c.length,c=[],x=0,r.value=n.entities.filter(h=>h instanceof u).length,w.value=n.entities.filter(h=>h instanceof v).length;let o=n.entities.filter(h=>h instanceof u);T.value.forEach(h=>{let m=o.find(N=>N.color===h.color);m?h.ships=m.ships.length:h.ships>0&&(h.ships=0)})}}}})}),$(()=>{S&&(S.destroy(),S=null)});function U(){n.entities.filter(c=>c instanceof u).forEach(c=>{c.set("money",c.money+10)})}return(x,c)=>(M(),I("div",te,[f("div",ie,[f("div",null,"Startup time: "+p(e.value.toFixed(2))+" ms",1),f("div",null,"Update time: "+p(t.value.toFixed(2))+" - "+p(s.value.toFixed(2))+" ("+p(d.value.toFixed(2))+" avg) ms",1),se,f("div",null,"Entities: "+p(r.value)+" stations and "+p(w.value)+" ships",1),(M(!0),I(j,null,H(T.value,g=>(M(),I("div",{key:g.color,style:L({color:g.displayColor})},p("#"+g.color.toString(16))+": "+p(g.ships),5))),128)),ae,f("button",{onClick:U},"Add Ships")]),he]))}}),me=Z(ne,[["__scopeId","data-v-36261972"]]);export{me as default};
